+++
date = "2017-04-30T12:00:00"
title = "大誤 · 後宮佳麗三千人"
titleimage = "https://pic2.zhimg.com/v2-6ed9c1f4f48fe2028b7ec9a7b5fd1a0d.jpg"
ga = 043012
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">皇上後宮佳麗三千，皇上從第一天開始每天隨機挑選一個寵幸，恰好寵幸完所有佳麗的天數的期望是多少？</h2>

<div class="answer">



<div class="content">
<p>答案是&nbsp;<strong>25751 天</strong> ，差不多是 70 年。</p>
<p><strong>剛開始寫答案時不夠認真，沒仔細檢查，雖然結果是對的，但中間步驟有很多紕漏和筆誤，給不少人造成了困擾，十分抱歉。幸而不斷有知友幫忙指出錯誤，大家的幫助下，我應該是把錯誤都改正了。</strong></p>
<p>感謝評論區，有人指出這個問題叫做 Coupon collector's problem(優惠券收集問題)。</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5Cfrac%7B1%7D%7B108%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=n" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5Cfrac%7Bn%7D%7BN%7D" alt="">
<img class="content-image" src="http://pic1.zhimg.com/70/v2-c4898737a3e6befd7f33cf7ff2d71174_b.jpg" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=n" alt="">
<p><strong>因爲專業背景用排隊論比較多，所以我最初把問題考慮成了一個馬爾可夫鏈，雖然也能求出結果，但複雜了很多，也不是那麼好理解，如果大家感興趣也可以看一下。</strong></p>
<p>我最初的解題過程如下：</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=n" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5C%7BX_n%2Cn%5Cge1%5C%7D" alt="">
<img class="content-image" src="http://pic2.zhimg.com/70/v2-a76bf1e18023b30afc28751463304e4d_b.jpg" alt="">
<p>接下來讓我們分析狀態轉移概率：</p>
<ul>
<li>當 <img class="content-image" src="http://www.zhihu.com/equation?tex=X_n%3D0" alt=""> 時，說明任何佳麗都沒有寵幸，則第二天寵幸過的妃子數量一定會加 1，即 <img class="content-image" src="http://www.zhihu.com/equation?tex=%5CPr%5C%7BX_%7Bn%2B1%7D%3D1%7CX_n%3D0%5C%7D%3D1" alt=""> ;</li>
<li>當 <img class="content-image" src="http://www.zhihu.com/equation?tex=X_n%3DS%5Cin%5B1%2CN-1%5D" alt="">時，代表 <img class="content-image" src="http://www.zhihu.com/equation?tex=S" alt=""> 個佳麗已經被寵幸， <img class="content-image" src="http://www.zhihu.com/equation?tex=N-S" alt=""> 個佳麗未被寵幸，則晚上皇帝寵幸到新妃子的概率爲 <img class="content-image" src="http://www.zhihu.com/equation?tex=%5Cfrac%7BN-S%7D%7BN%7D" alt="">，即 <img class="content-image" src="http://www.zhihu.com/equation?tex=%5CPr%5C%7BX_%7Bn%2B1%7D%3DS%2B1%7CX_n%3DS%5C%7D%3D%5Cfrac%7BN-S%7D%7BN%7D" alt=""></li>
<li>晚上皇帝寵未幸到新妃子的概率爲 <img class="content-image" src="http://www.zhihu.com/equation?tex=%5CPr%5C%7BX_%7Bn%2B1%7D%3DS%7CX_n%3DS%5C%7D%3D%5Cfrac%7BS%7D%7BN%7D" alt=""> ；</li>
</ul>
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5Clambda_%7Bij%7D" alt="">
<ul>
<li>當 <img class="content-image" src="http://www.zhihu.com/equation?tex=i%3Cj" alt=""> 和 <img class="content-image" src="http://www.zhihu.com/equation?tex=j-i%3E1" alt=""> 時， <img class="content-image" src="http://www.zhihu.com/equation?tex=%5Clambda_%7Bij%7D%3D0" alt=""> ，代表皇帝寵幸過的佳麗數量是不會減少的，以及每晚增加的數量最多爲 1；</li>
<li>當 <img class="content-image" src="http://www.zhihu.com/equation?tex=i%3Dj" alt=""> 時， <img class="content-image" src="http://www.zhihu.com/equation?tex=%5Clambda_%7Bij%7D%3D%5Cfrac%7Bi%7D%7BN%7D" alt=""></li>
<li>當 <img class="content-image" src="http://www.zhihu.com/equation?tex=j%3Di%2B1" alt=""> 時， <img class="content-image" src="http://www.zhihu.com/equation?tex=%5Clambda_%7Bij%7D%3D%5Cfrac%7BN-i%7D%7BN%7D" alt=""> ；</li>
</ul>
<img class="content-image" src="http://www.zhihu.com/equation?tex=N%3D5" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5C%5BP+%3D+%5Cleft%5B+%7B%5Cbegin%7Barray%7D%7B%2A%7B20%7D%7Bc%7D%7D+%7B%7B%5Clambda+_%7B00%7D%7D%7D%26%7B%7B%5Clambda+_%7B01%7D%7D%7D%26%7B%7B%5Clambda+_%7B02%7D%7D%7D%26%7B%7B%5Clambda+_%7B03%7D%7D%7D%26%7B%7B%5Clambda+_%7B04%7D%7D%7D%26%7B%7B%5Clambda+_%7B05%7D%7D%7D%5C%5C+%7B%7B%5Clambda+_%7B10%7D%7D%7D%26%7B%7B%5Clambda+_%7B11%7D%7D%7D%26%7B%7B%5Clambda+_%7B12%7D%7D%7D%26%7B%7B%5Clambda+_%7B13%7D%7D%7D%26%7B%7B%5Clambda+_%7B14%7D%7D%7D%26%7B%7B%5Clambda+_%7B15%7D%7D%7D%5C%5C+%7B%7B%5Clambda+_%7B20%7D%7D%7D%26%7B%7B%5Clambda+_%7B21%7D%7D%7D%26%7B%7B%5Clambda+_%7B22%7D%7D%7D%26%7B%7B%5Clambda+_%7B23%7D%7D%7D%26%7B%7B%5Clambda+_%7B24%7D%7D%7D%26%7B%7B%5Clambda+_%7B25%7D%7D%7D%5C%5C+%7B%7B%5Clambda+_%7B30%7D%7D%7D%26%7B%7B%5Clambda+_%7B31%7D%7D%7D%26%7B%7B%5Clambda+_%7B32%7D%7D%7D%26%7B%7B%5Clambda+_%7B33%7D%7D%7D%26%7B%7B%5Clambda+_%7B34%7D%7D%7D%26%7B%7B%5Clambda+_%7B35%7D%7D%7D%5C%5C+%7B%7B%5Clambda+_%7B40%7D%7D%7D%26%7B%7B%5Clambda+_%7B41%7D%7D%7D%26%7B%7B%5Clambda+_%7B42%7D%7D%7D%26%7B%7B%5Clambda+_%7B43%7D%7D%7D%26%7B%7B%5Clambda+_%7B44%7D%7D%7D%26%7B%7B%5Clambda+_%7B45%7D%7D%7D%5C%5C+%7B%7B%5Clambda+_%7B50%7D%7D%7D%26%7B%7B%5Clambda+_%7B51%7D%7D%7D%26%7B%7B%5Clambda+_%7B52%7D%7D%7D%26%7B%7B%5Clambda+_%7B53%7D%7D%7D%26%7B%7B%5Clambda+_%7B54%7D%7D%7D%26%7B%7B%5Clambda+_%7B55%7D%7D%7D+%5Cend%7Barray%7D%7D+%5Cright%5D+%3D+%5Cleft%5B+%7B%5Cbegin%7Barray%7D%7B%2A%7B20%7D%7Bc%7D%7D+0%261%260%260%260%260%5C%5C+0%26%7B%5Cfrac%7B1%7D%7B5%7D%7D%26%7B%5Cfrac%7B4%7D%7B5%7D%7D%260%260%260%5C%5C+0%260%26%7B%5Cfrac%7B2%7D%7B5%7D%7D%26%7B%5Cfrac%7B3%7D%7B5%7D%7D%260%260%5C%5C+0%260%260%26%7B%5Cfrac%7B3%7D%7B5%7D%7D%26%7B%5Cfrac%7B2%7D%7B5%7D%7D%260%5C%5C+0%260%260%260%26%7B%5Cfrac%7B4%7D%7B5%7D%7D%26%7B%5Cfrac%7B1%7D%7B5%7D%7D%5C%5C+0%260%260%260%260%261+%5Cend%7Barray%7D%7D+%5Cright%5D%5C%5D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=x%3D%5Bx_0%2Cx_1%2Cx_2%2C%5Cldots%2Cx_%7B5%7D%5D%5ET" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=Px%3Dx%2B1" alt="">
<ul>
<li>皇帝每晚的寵幸都會使得時間花費 +1；</li>
<li>而 <img class="content-image" src="http://www.zhihu.com/equation?tex=Px" alt=""> 代表過去 1 晚後，各個期望的變化；</li>
<li>上述二者應該等價，因此有該關係式；</li>
</ul>
<p>又，上式等同於(第 6 行左側爲 0，所以捨去)：</p>
<img class="content-image" src="http://pic3.zhimg.com/70/v2-d7b080e519f4c36b6e4aaef51585deae_b.jpg" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=I" alt="">
<img class="content-image" src="http://pic1.zhimg.com/70/v2-cb11eda7f4e6012d8e5ad2288b733ab8_b.jpg" alt="">
<p>會發現這個線性方程非常有規律，口算即可解出。<strong>遞推公式爲：</strong></p>
<img class="content-image" src="http://pic3.zhimg.com/70/v2-27cde2e5ed193552c5d5d940839ff90e_b.jpg" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=x_5%3D11.4167" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=N%3D3000" alt="">
<img class="content-image" src="http://pic4.zhimg.com/70/v2-507b7ba4d0049ef089cd1474fd3b351f_b.jpg" alt="">
<p><strong>得到平均時間爲 25751 天（計算時間不到 6 毫秒）。</strong></p>
<p>而且上述公式再加上一點簡單的變化，還可以進一步化簡爲：</p>
<img class="content-image" src="http://pic1.zhimg.com/70/v2-cc00bdb52740a6a3e828dce927df15bc_b.jpg" alt="">
<p><strong><strong>數學最美的地方便在於殊途同歸~</strong></strong></p>
<p><strong>我計算了幾組後宮佳麗數量下的期望天數：</strong></p>
<img class="content-image" src="http://pic1.zhimg.com/70/v2-dfe04f3cfeacf79cc4bf6e341b4bd668_b.jpg" alt="">
<p>（重申一下，這道題用馬爾科夫鏈是大炮打蚊子了，太過麻煩。但如果問題複雜一些，例如每隔一段時間都會有新人入宮，老人離宮，那麼馬爾科夫鏈可能會有用武之地）</p>
</div>
</div>




</div>


</div>
</div>