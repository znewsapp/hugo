+++
date = "2017-04-22T15:00:00"
title = "炸潛艇有點難，不過速 8 裏的天眼和殭屍車隊是真的能實現"
titleimage = "https://pic4.zhimg.com/v2-8e393bf0d677eb704ade58094f8c09ab.jpg"
ga = 042215
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">



<div class="question">
<h2 class="question-title">《速度與激情 8》中的信息安全技術</h2>
<div class="answer">



<div class="content">
<p>前言：本文中的技術僅供交流，如有疏漏還請大家批評指正。</p>
<p>今天跟女票下班之後直接去電影院看速 8，當然看完速 8 之後並沒有去速八而是直接回了家。首先對電影給個正面的評價，但是本人作爲一個信息安全從業者，有必要扒一扒裏面的黑客技術。</p>
<p>裏面涉及到黑客技術的東西主要有兩個&mdash;&mdash;天眼（The Eye）和殭屍車隊（Zombie Cars）。</p>
<p>對於這兩個東西其實和現實當中兩項比較前沿的安全技術相關&mdash;&mdash;汽車及物聯網安全和攻擊者溯源，對於汽車安全這一部分，我的基友鬧心均<a class="member_mention" href="http://www.zhihu.com/people/99baa09c00f17fffcdd281e48ebeb5e9">@Selfighter</a>是磚家中的磚家，可惜人在 HITB，所以我先很業餘的說一些這方面的東西。</p>
<img class="content-image" src="http://pic1.zhimg.com/v2-d87ef83a7c802ea04a65140408cc4c44_b.jpg" alt="">
<p>首先我們先來說說智能汽車和非智能汽車，智能汽車其實就可以當做一個物聯網設備來解決，也就是說智能汽車的攻擊面和其他 IoT 設備的攻擊面是差不多甚至更多的。</p>
<p>其實汽車和計算機一樣，內部通信依靠總線進行，汽車中的總線是 CAN 總線。CAN 網絡是由以研發和生產汽車電子產品著稱的德國 BOSCH 公司開發的，並最終成爲國際標準（ISO 11898），是國際上應用最廣泛的現場總線之一。CAN 總線協議目前已經成爲汽車計算機控制系統和嵌入式工業控制局域網的標準總線，同時也是車載 ECU 之間通信的主要總線。當前市場上的汽車至少擁有一個 CAN 網絡，作爲嵌入式系統之間互聯的主幹網進行車內信息的交互和共享。CAN 總線的短幀數據結構、非破壞性總線仲裁技術、靈活的通訊方式等特點能夠滿足汽車實時性和可靠性的要求，但同時也帶來了系列安全隱患，如廣播消息易被監聽，基於優先級的仲裁機制易遭受攻擊，無源地址域和無認證域無法區分消息來源等問題。特別是在汽車網聯化大力發展的背景下，車內網絡攻擊更是成爲汽車信息安全問題發生的源頭，CAN 總線網絡安全分析逐漸成爲行業安全專家聚焦點。如 2013 年 9 月 DEFCON 黑客大會上，黑客演示了從 OBD-II 控制福特翼虎、豐田普銳斯兩款車型實現方向盤轉向、剎車制動、油門加速、儀表盤顯示等動作。汽車車內 CAN 網絡安全問題當前主要通過安全漏洞的分析和各種攻擊手段進行挖掘，因爲汽車車內網絡安全的脆弱性和威脅模型的分析尤爲關鍵。</p>
<p>這麼說來，只要抓住了 CAN 總線，我們就相當於是抓住了汽車的神經，也就能對汽車進行控制，那麼攻擊 CAN 總線會引發什麼後果呢？</p>
<p>第一個後果是失控：CAN 總線主要應用之一是支持主動安全系統的通信，道路車輛行駛的時候，主動安全系統將是一把雙刃劍，在它們發揮着不可替代的功能時候，但是考慮到主動安全系統的可操作和有能力調整正確的輸入，也會引起駕駛者對主動安全系統的完全依賴。因此一個突然的故障會引起不可預知的危險後果。爲了引發一個危險的條件，惡意的攻擊者將會在 CAN 總線中注入錯誤幀，讓主動安全系統失靈。例如，在牽引力控制系統裏安裝一個攻擊，會造成車輛失去控制等危險。如果攻擊者的目標是自適應巡航系統，將會導致汽車不會安駕駛者預期的那樣停止。此外，爲了最大可能的傷害汽車駕駛者，假如數據可以直接從 CAN 總線上獲取，攻擊者可以根據特定的條件，觸發一個 DoS 攻擊。例如汽車某一特定速度，特定的節氣門百分比或者是某一確切的 GPS 位置等。</p>
<p>第二個後果就是勒索：一個惡意的攻擊者將在 CAN 總線中某一目標幀中設置攻擊，這將會導致駕駛者無法控制節氣門的位置從而不能讓汽車移動。儘管這些不會必定發生危險狀態，一個以金錢爲目的的攻擊者，將會利用車載娛樂系統的漏洞，停止汽車，並在娛樂系統屏幕上顯示消息，車主爲了重新獲取汽車的操控權而去付贖金。</p>
<p>第三個可能是盜竊：大部分現代昂貴的汽車門鎖通過 CAN 連接到 ECU 來控制，通常通過 OBD-II 端口可連接。隔離負責控制鎖 / 解鎖車門的數據幀比逆向主動安全設備更簡單、更快捷。因此，幾分鐘左右一個攻擊者將會隔離負責鎖車門的數據幀，編寫他的設備程序 - 特定幀的 DoS 攻擊，然後把設備插入到 OBD-II 的接口，阻止車門鎖住。對於一個攻擊者來說，這個攻擊結果是可能的。通過低成本的花費就能進入到車內，隨後就能夠竊取車內任何貴重物品。</p>
<p>長期以來，幾乎整個汽車界都有這樣的共識：<strong>CAN 總線是沒法保護的。兩方面的原因，其一，ECU 的計算處理能力不足；其二，車載網絡的帶寬有限</strong>。有些 LIN 總線使用的 MCU 甚至是 16bit 或 8bit，但 AES 使用的加密算法只能處理 16 字節區塊的數據，這意味着很多時候 LIN 總線根本就是處在&ldquo;裸奔&rdquo;的狀態。所以汽車安全未來肯定是炙手可熱的一部分。</p>
<img class="content-image" src="http://pic1.zhimg.com/v2-150c7035fdf4540e9a6525e8be2edb00_b.jpg" alt="">
<p>接下來我們說說天眼，其實天眼的目標很簡單&mdash;&mdash;我知道一個人的一部分信息，如何根據一部分信息去拼湊出一個完整的信息，比如他去過什麼地方，幹過什麼事情，目的是什麼，用了什麼東西，也就是廣義上的瞭解你的敵人。對於安全工作者來說，轉化到現實當中的問題就是甲方安全團隊在找到攻擊者之後如何讓攻擊者不再攻擊你？單單從防禦的角度上來說，我們可以上規則、上設備，但是這樣並不能從根本上解決問題。繼續說回電影，其實《赤道》中香港、韓國兩方面只希望把武器送走，確保不在香港交易同時回到韓國，這樣就解決了這個問題。但是宋總不是這麼想，宋總站在了更高的角度上，他不希望把香港變成真正的地下武器販賣中心，也就是要把地下武器交易這個鏈條徹底打碎。從解決問題的角度上來看這兩者都沒錯。</p>
<p>回到正題，對於攻擊者來說，攻擊者一旦發起攻擊就會在目標系統中產生數據，不管有用也好無用也罷，總之數據都會產生，諸如流量數據、操作日誌、爆破記錄、工具指紋、網絡地址等信息。</p>
<p>Phase 1：從日誌分析的角度上來講，既然我們有這麼多的設備，有這麼多的日誌，我們要做的就是把這些想關的攻擊向量和行爲日誌收集起來，統一到一起，看看有什麼線索。</p>
<p>Phase 2：既然我們已經收集到了很多的日誌和數據，那麼我們可以從日誌中把這些信息拼湊成一個完整的攻擊行爲記錄：即它是通過什麼漏洞進來的，如何進來的，進來之後做了什麼，對系統有什麼影響。完完全全使之成爲一個攻擊的模型，這樣的話也就完成了對入侵的推演。</p>
<p>Phase 3：我們既然知道了他是如何進來了的，從甲方安全運營的角度來講，我們需要確認其他機器當中是否有相同的漏洞和配置錯誤，要避免其它的人利用相同的方法入侵系統，畢竟不能在一個坑栽倒兩次。</p>
<p>Phase 4：我們現在有了攻擊者的一些信息，我們是否可以通過外部威脅情報數據來看看這個攻擊者是不是之前攻擊過其他系統，攻擊是不是有針對性，工具用的是進口的、國產的還是自己寫的，是不是有其他的同夥或者幫手，他到底是懷揣着什麼目的去攻擊我們的系統。</p>
<p>Phase 5：如果我們確定他的身份是惡意的，並且對我們的系統造成了很嚴重的影響，我們是不是應該知道這個人是什麼來頭，他的個人信息（虛擬身份和真實身份）我們是不是要了解，我們是不是應該去用法律手段搞他，等等。</p>
<p>其實攻擊溯源，其實是數據驅動的企業內部安全運營的一部分，需要大量數據的支撐以及分析才能找到攻擊者，而企業內部我們見到最多的數據無非就是日誌了，所以日誌的分析和內網威脅情報的提取是非常重要的一環。</p>
<p>針對安全運營來說，我個人認爲所有的攻擊者不可避免的都會產生操作日誌，針對內網內的安全設備也好，非安全設備也好，肯定或多或少的存在日誌。</p>
<p>針對企業內部的日誌，大體上可分爲四類：安全設備日誌、非安全設備日誌、傳感器日誌和外部數據。</p>
<p>對於追蹤來說一般有這麼三種套路：</p>
<p>IP-＞域名 -＞Whois 信息 -＞社交網絡信息 -&gt;真實信息：這個套路對於現在來說可能用處不是特別大，但是根據歷史 Whois 信息也是可以得出一些啓發性的結論的，當然這些威脅情報數據可能付費。</p>
<p>IP-＞VPN-＞IP-&gt;社交網絡信息：這種情況一般是大多數，解決方法是通過查詢 IP 反連記錄，解析操作和一些 fingerprint 獲得他的虛擬身份信息，當然也是要收費的</p>
<p>IP-&gt;botnet-＞IP-&gt;社交網絡信息：這種廣泛分佈於挖礦、刷票、DDoS 這種肉雞類型的，可以想辦法截獲起 botnet 樣本進行逆向分析，獲取其 c&amp;c 服務器地址，然後對服務器進行反連查詢。沒錯還是要收費的。</p>
<p>安全設備日誌：這些日誌來源可以是硬件也可以是軟件，首先就硬件來說注入 IDS/WAF 或者 SIEM 中的日誌、硬件防火牆等等日誌，軟件日誌包括防病毒軟件、安全 Agent、准入系統等軟件系統的日誌。這些日誌一般都是攻擊者進行攻擊時會進行被動觸發，這樣的話可以檢索到很多攻擊信息，諸如使用的 IP、端口、工具指紋等等。</p>
<p>非安全設備日誌：諸如路由器、交換機、網關、網閘等硬件設備以及操作系統、應用軟件、服務器軟件日誌等軟件日誌，這些日誌中可以分析出攻擊者的目的，是爲了單純滲透玩一下還是想要通過控制機器作爲跳板機進行進一步的滲透工作，還是說僅僅是安全部門進行掃描產生的日誌。</p>
<p>傳感器日誌：企業內部通常會部署一些蜜罐系統、流量傳感器等，這些設備一方面可以有攻擊預警和反橫向滲透的效果，但是裏面也會存在一些攻擊者的行爲，比如 SSH 蜜罐會存下攻擊者在這臺機器上的操作，流量傳感器會對數據包進行 DPI 解析方便流量分析，這些數據中肯定殘存着一些有用的信息可以幫助我們確定攻擊者的行爲、技能點，甚至可以進一步判斷該攻擊者的能力，是腳本小子還是大黑闊。</p>
<p>外部日誌：一些常用服務的日誌，比如說郵件、DNS 等日常服務的日誌，這些日誌可以幫我們確定攻擊者是否是一種 APT 攻擊，或者是是否是來種植 Botnet 的。同樣可以確定攻擊者的動機。</p>
<p>說完了日誌，我們緊接着可以說一下攻擊者的動機判定，攻擊者想要入侵一個系統肯定會對這個系統進行偵查，諸如端口掃描、脆弱性檢測、exp 測試等手段，這裏面很容易和安全部門的安全常規巡檢的日誌起衝突，大多數公司都會把掃描機羣放到白名單裏。這樣產生了類似的日誌就會觸發報警，我們可以進一步分析這些日誌提取出一些攻擊者的行爲、動機等等，以及他的目的甚至他的技能點，我們都可以初步判斷。</p>
<p>通過對以上日誌的分析，我們可以基本上確定攻擊者是什麼途徑進來的，用何種攻擊方式拿到機器權限，有沒有執行什麼敏感的操作，是否有進一步滲透的趨勢，是不是在嘗試提權之類的操作等等，這樣我們就對攻擊者有一個大概的瞭解。</p>
<p>接下來我們就需要藉助外部威脅情報的力量來獲取攻擊者的身份，我個人比較喜歡國內的微步在線和國外的 PassiveTotal 這兩個平臺，尤其是後者，數據比較全而且覆蓋度很廣。當然不差錢的各位可以選擇去買威脅情報服務，更專業。</p>
<p>簡單說一下威脅情報可以幫我們幹什麼，威脅情報其實就是根據上面獲得殘破的攻擊者畫像變得完整，威脅情報一般可以獲得這個攻擊者有哪些常用的 IP，這些 IP 分別都是幹什麼的，有沒有什麼社交信息，社交信息又有什麼關聯。舉個不恰當的例子就是相當於你知道一個人的身份證號，然後警察用這個身份證號去查這個人有多少錢，資產有多少等等。這樣你就可以獲得一個較爲完整的攻擊者畫像。</p>
<p>到了這裏其實我們知道了攻擊者的信息，就可以選擇怎麼解決，拉倒辦公室彈 jj10 分鐘是一個解決方案，扭送到警察蜀黍那裏也是解決方案，但是需要提醒大家注意執法力度和執法手段，不要知法犯法（逃。</p>
<p>說到以上大家會覺得我偏題了，你娃不是說要講天眼麼，怎麼扯了一大堆安全運營上的事兒，這跟天眼有什麼關係。那麼接下來的事情就和天眼有關係了：</p>
<p>在電影中，飛車家族只需要輸入一個名字就可以去找到這個人，確定他的位置，然後上門送溫暖喝熱茶。但是現實當中，重名的你懂得，所以我們現在從其他的地方下手：</p>
<p>Part 1：長相，這裏無非就是涉及到人臉識別技術，沒什麼好說的（其實是我不懂）</p>
<p>Part 2：身份證號碼，這個就比較重要了，身份證號碼對於廣大人民羣衆來說，變的機會基本爲 0，很多企業不管是幹什麼的也好都喜歡玩實名制，尤其是一些小的金融公司和 P2P 公司，總喜歡沒事問你身份證號。鑑於我國信息泄露這個問題還是挺嚴重的，所以我們不能保證別人沒有我們的身份證號。我們來說有了身份證號能幹什麼：先來造一張假的身份證，然後利用這張身份證（照片或者掃描件）去搞一些不需要實體身份證的東西，比如你懂得。這樣我們就能把這個人的一些賬戶劫持了，能幹啥你現在應該明白了。</p>
<p>Part 3：手機號碼，一般我們通信都用手機號碼，手機號碼泄露更是屢見不鮮，和身份證號一樣，許多企業都是動不動就跟你要。手機號碼泄露更是一件蛋疼的事情，騷擾電話短信不說，由於現在很多手機號碼和業務是綁定的，也就是用手機號碼就可以登錄相關的業務，這樣的話手機號碼的泄露很有可能就會聯繫到相對應的身份，舉個最簡單的例子：手機號碼綁定 QQ 號碼，然後 QQ 號碼可以查詢羣關係，之後通過羣關係能搞出很多信息，後果你懂的</p>
<p>Part 4：QQ 號碼，其實上面已經說了，QQ 號碼相當於虛擬版本的身份證號，很多東西都和 QQ 有關係，比如 iCloud 賬號、遊戲賬號、甚至是一些信用卡賬單啊什麼的綁定的郵箱都是 QQ 的。QQ 號碼能查的東西那就太多了，上面就是個例子。</p>
<p>Part 5：電子郵箱，這個在國內似乎用的比較少，但是企業內部的電子郵箱是討論的重點，企業內部電子郵箱是很多攻擊者最喜歡的地方，因爲可以以此爲突破口獲取企業內部的一些信息。當年在甲方做安全運營的時候經常收到各種同時轉發過來的釣魚郵件，就是用來騙取 Exchange 郵箱賬戶的，這些對企業內部安全構成了嚴重的威脅。</p>
<p>所以，天眼的實現基礎，其實是背後的數據在做支撐，數據，其實就是泄露的數據，民間收集的數據來源主要還是各大數據庫泄露的 SQL 文件等，當然不排除有些萬惡的黑產玩無間道，此處有句 xxx 我一定要講。</p>
<p>其實《速度與激情 8》裏面的黑客技術就現在看來是可以完全實現的，只是實現的成本有高有低，但是搞攻防的話，一定要站在攻擊成本的角度上去考慮，安全無絕對，所以大家也沒有必要爲這些事情擔心，安全研究院和廠商之間的互動越來越多也從側面證明了現在大家對安全的重視，作爲安全工作者，我們也非常願意幫助廠商做好安全這一部分。先說這麼多吧，此文僅作爲科普，如需討論細節還請回復或者發私信。</p>



</div>
</div>
</div>


</div>
</div>