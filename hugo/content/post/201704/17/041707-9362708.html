+++
date = "2017-04-17T07:00:00"
title = "網線裏，司機老王正拉着 50 頓貨物在高速公路上狂奔"
titleimage = "https://pic2.zhimg.com/v2-0a6c2b2c4393bf5a9c0ff9df83fcf5ad.jpg"
ga = 041707
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">網絡傳輸中，數據包能在中間節點上重組嗎？</h2>

<div class="answer">



<div class="content">
<p>司機老王拉着 50 頓貨物在高速公路上狂奔，到了一座長江大橋，限重 40 噸（<strong>MTU</strong>），老王加個油門想闖過去，結果被交警攔下，交警批評老王超重了，給老王兩種選擇：</p>
<p><strong>1）掉頭回去</strong></p>
<p><strong>2）卸掉 10 噸貨，到另外一輛車</strong></p>
<p>老王選擇了方案二，兩輛車將 50 噸的貨物一直運輸到目的地。</p>
<p><strong>那老王可否在中途將貨物合二爲一呢？</strong></p>
<p>老王想，也許前方還有很多關卡，檢查超重，到時還會再卸貨，那多麻煩啊，還不如用兩輛車一直運到目的地算了，據路邊社不可靠消息，關卡的限重通常都是 40 噸<strong>（MTU 1500）</strong>，所以卸一次貨就安全了。</p>
<p>老王拉的貨是<strong>菜籃子工程（合法端口號）</strong>，除了超重缺貨之外，在安全檢查站都是暢通無阻，這裏有一個問題，拉着 10 頓貨的車子沒有菜籃子工程的 LOGO（<strong>端口號</strong>），所以安全檢查站有點犯難，不讓過，可能影響菜籃子工程，讓過，萬一裏面裝載的是違禁貨物，豈不是讓違禁貨物矇混過關？</p>
<p>有同學說，違禁貨物一看便知，問題是安全檢查的都是機器人，大腦還不夠發達，無法完成那麼智能的判斷。</p>
<p>把老王叫來，你的運輸貨物清單拿來，一看貨物總重 50.18 噸，將兩輛車的重量加在一起，去掉第二輛車的車身重量，恰好是 50.18 噸，看來第二輛車裏貨物也是老王的，全部放行。</p>
<p>這個安全檢查所做的工作就是&nbsp;<strong>VFR（Virtual Fragment Reassemble)</strong>，可以避免由於第二個分片沒有端口號，而讓防火牆犯難，可以將兩個分片虛擬重組一下，判斷合法放行，不合法丟棄。</p>
<p>所謂<strong>虛擬重組</strong>，是因爲並沒有真的將分片重組，只是邏輯上計算，看能否將分片重組成一個 IP 包，在傳輸的過程中依然是兩個分片，到達目的地最終完成重組。</p>
<p>IPv6 就更簡單了，源主機分片，目的主機重組，沒有其他情況。</p>
</div>
</div>




</div>


</div>
</div>