+++
date = "2016-09-02T07:00:00"
title = "職場新人的福利，學好了，要做一小時的表格幾分鐘就搞定"
titleimage = "http://pic2.zhimg.com/89d95ebb5ac3086e19c1a0e855240be1.jpg"
ga = 090207
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">工作被效率更高的機器搶了是什麼體驗？</h2>

<div class="answer">



<div class="content">
<p>看到這個話題，我決定送給職場新人一個福利~~</p>
<p>我剛畢業那會，Excel 數據透視表都不會，後來進入 DBA 部門用得更少了。</p>
<p>工作過程中一個做 Excel 的妹子找我抱怨，做一個表要花一兩個小時，甚至三四個小時，請教我能否想想辦法，我用 R 寫個程序可以。考慮到妹子家裏公司都要做事，不太想安裝 R。我想到了 VBA，在大學時學過一點 VB，正好練練手。</p>
<p>花一天整理妹子的需求，用一週學習，然後就寫出了</p>
<p>3 個自定義函數</p>
<p>2 個自動更新數據</p>
<p>後來寫着寫着就順手，經常幫妹子寫報表自動化程序。</p>
<p>導致妹子對我產生依賴性，她每天就想按幾個鍵然後工作都完成了。</p>
<p>我建議她可以看看我的代碼，我都寫好註釋了，你可以按照註釋去改參數，就不用天天問我了，但妹子看不懂，我教了幾遍遂放棄。</p>
<p>對了上面說的福利，當然是貼代碼，這份福利給文職類的處理 Excel 的新人，程序員不要搗亂。</p>
<p><strong>情景 1</strong>：一個工作簿，你按照地區或者部門等你自己的需要拆成不同的工作簿（需求是不是很簡單，nonono，單獨做一個當然簡單，但是我貼出來肯定是這個代碼是通用的。比如你想拆第幾行開始娜一列都可以，會有選項讓你一步一步選擇）</p>
<p><strong>情景 2：</strong>比如拆完，有 30 張表，你想發給 30 個不同的人看？你是不是要同時寫 30 封郵呢</p>
<p>關於情景 1 的工作時間：如果一張總表有三十城市，要按照城市拆成三十個工作簿，不斷複製 + 改工作簿名，個人覺得至少得二十分鐘吧，還有容易出錯的概率。</p>
<p>關於情景 2 的工作時間：這個就更麻煩了。三十個城市名，要下發給三十個不同分公司的人，而且不同分公司的人，不是隻有一個人。你第一次發，如果郵箱有羣組還好，但是你始終得寫三十封郵件，還要注意選擇工作簿不能出錯，郵件主題內容不能出錯。預估這個工作時間至少得一個小時，平均一封郵件 2 分鐘。</p>
<p>情景 1+ 情景 2 時間=一小時二十分鐘（據我觀察，歷史五個人做這件事出錯率 100%，不是城市名寫錯了，就發錯工作簿了）</p>
<p>不知道大家看懂了沒= =</p>
<p>好了開始寫步驟貼代碼，我會盡量用最通俗的語言講清邏輯關係</p>
<p>步驟 1：建立兩個 sheet，點擊 sheet ，右擊查看代碼（先檢查 Excel 是否啓用宏，要啓用宏哦）</p>
<img class="content-image" src="http://pic2.zhimg.com/70/71ce6930f50205014eb04bc2251c6e59_b.jpg" alt="">
<img class="content-image" src="http://pic2.zhimg.com/70/98bfd2757a90422e513c09232a441671_b.jpg" alt="">
<img class="content-image" src="http://pic4.zhimg.com/70/e77a6697abd4762a5ea30e2ecf39d3bb_b.jpg" alt="">
<p>插入窗體和模塊，按模塊，把以下這串代碼複製進去</p>
<img class="content-image" src="http://pic3.zhimg.com/70/f011a647c1eb257ee09b43bae14d97c6_b.jpg" alt="">
<p>再按窗體，設置成這樣</p>
<img class="content-image" src="http://pic4.zhimg.com/70/ff74ea61d86d5801e1f61446b808440b_b.jpg" alt="">
<p>然後看到代碼，拉到最後，能看到一個是郵件簽名，一個是郵箱配置，你自己填上即可，郵件內容可以自己改</p>
<img class="content-image" src="http://pic4.zhimg.com/70/2e24e797c9705b9542b2908328cee1a7_b.jpg" alt="">
<p>截止到這步，代表所有準備工作都完成了，咱們開始測試吧^_^</p>
<p>29 個城市，我拆成 29 個工作簿，點擊宏</p>
<img class="content-image" src="http://pic4.zhimg.com/70/4ccdbcd8b10eff471134571e4bd86dc7_b.jpg" alt="">
<img class="content-image" src="http://pic4.zhimg.com/70/3af254d33aa55b3e8383007f5db16fa3_b.jpg" alt="">
<img class="content-image" src="http://pic3.zhimg.com/70/72497e218e6c26bd752b89a5b7df8bb2_b.jpg" alt="">
<img class="content-image" src="http://pic4.zhimg.com/70/e2cfa90d3c3b52caf2938886e1a3d61f_b.jpg" alt="">
<img class="content-image" src="http://pic1.zhimg.com/70/9fc7c3eeacc9938ae038c36381f1840c_b.jpg" alt="">
<p>按完確定大概 10 秒後，跟你 Excel 同個文件夾內，會生成拆分的文件夾，你點進去</p>
<img class="content-image" src="http://pic1.zhimg.com/70/573c9c14bd0e8732ec7242e11fe83c80_b.jpg" alt="">
<p>已經生成了，如果沒有想要發郵件的同學，在這裏就可以結束啦。</p>
<img class="content-image" src="http://pic2.zhimg.com/70/928e8b78cc1a3cb5ed20119e48e884ad_b.jpg" alt="">
<p>打開工作簿看看，拆分如何</p>
<img class="content-image" src="http://pic2.zhimg.com/70/1f33add9aee1b63a1e630a7f5b97d425_b.jpg" alt="">
<p>想把三十個工作簿發送郵件的同學，注意看下面，轉到通訊錄的那個 sheet，</p>
<img class="content-image" src="http://pic2.zhimg.com/70/66e2a267290443f92c27ff4689664e25_b.jpg" alt="">
<img class="content-image" src="http://pic1.zhimg.com/70/aee1d2f4be44ddc32cd048ec78bc2890_b.jpg" alt="">
<img class="content-image" src="http://pic3.zhimg.com/70/8f2782e2a8e83022adc58a00cdb02c12_b.jpg" alt="">
<p>這裏點擊一次文件夾，直接按確定，不用雙擊進入文件夾</p>
<img class="content-image" src="http://pic2.zhimg.com/70/bca6f78784548f0283401ca74f61fedd_b.jpg" alt="">
<img class="content-image" src="http://pic1.zhimg.com/70/a4399fa65110df67b064b32aeab79810_b.jpg" alt="">
<p>按完確定後，這時候按照工作簿數來算時間，基本上每秒一個城市，也就是一個工作簿。等到這個提示出來之後，你就可以直接看到結果了。</p>
<img class="content-image" src="http://pic1.zhimg.com/70/ff44fb2b39b1dfacaf8800181ed66954_b.jpg" alt="">
<p>然後你在看，是否有收到郵件</p>
<p>打開你的郵箱</p>
<img class="content-image" src="http://pic1.zhimg.com/70/37f39ed37d6a4d4128664bd54ddfa1b0_b.jpg" alt="">
<p>收到啦</p>
<img class="content-image" src="http://pic2.zhimg.com/70/40f4fb4a2dca641d193b64b9030c86d5_b.jpg" alt="">
<p>整套點擊 + 運行大約三分鐘</p>
<p>代碼：</p>
<p>Sub 通用拆分()</p>
<p>'On Error Resume Next</p>
<p>Application.ScreenUpdating = False '關閉屏幕更新</p>
<p>Application.DisplayAlerts = False '關閉提示事件,防止刪除表格時提示</p>
<p>Dim Pro, Wb1, Wb2, St1, Sht, Rng, Itm, StRow, Pth</p>
<p>Set Wb1 = ThisWorkbook</p>
<p>Set St1 = ActiveSheet</p>
<p>a = MsgBox("當前文件爲：" &amp; Wb1.Name &amp; Chr(10) &amp; "當前表格爲：" &amp; St1.Name &amp; Chr(10) &amp; Chr(10) &amp; "點擊 確定 繼續運行，" &amp; Chr(10) &amp; "點擊 取消 退出程序。", 1)</p>
<p>If a = 2 Then '如果點了取消,就退出程序</p>
<p>Exit Sub</p>
<p>End If</p>
<p>b = InputBox("請輸入拆分列表頭所在的單元格位置。" &amp; Chr(10) &amp; "例如：要拆分的列位於 C 列，表頭是第 3 行，就輸入&ldquo;C3&rdquo;")</p>
<p>If b = "" Then</p>
<p>MsgBox ("未輸入拆分表頭，程序退出")</p>
<p>Exit Sub</p>
<p>End If</p>
<p>rowx = St1.Range(b).Row</p>
<p>colx = St1.Range(b).Column</p>
<p>Set Pro = CreateObject("Scripting.Dictionary") '建立一個以省份爲關鍵字的字典</p>
<p>StRow = St1.Cells.Find("*", SearchOrder:=xlByRows, LookIn:=xlValues, SearchDirection:=xlPrevious).EntireRow.Row '確定當前文件行數</p>
<p>St1.Range(rowx &amp; ":" &amp; rowx).AutoFilter Field:=colx, Criteria1:="*" '取消篩選</p>
<p>For Each Rng In St1.Range(St1.Cells(rowx + 1, colx), St1.Cells(StRow, colx)) '</p>
<p>If Not Pro.exists(Rng.Value) And Not IsError(Rng.Value) Then Pro.Add Rng.Value, Rng.Value '判斷當前表格的值是否在字典內,如果不在,就添加到字典內</p>
<p>Next</p>
<p>namex = InputBox("請輸入文件名的自定義字段，" &amp; Chr(10) &amp; "例如輸入&ldquo;收款明細&rdquo;,就會生成&ldquo;上海 - 收款明細.xlsx&rdquo;文件", "", St1.Name)</p>
<p>For Each Itm In Pro.Items '針對字典內的每個值進行一次操作(每個省份循環一次)</p>
<p>St1.Copy</p>
<p>Set Wb2 = ActiveWorkbook</p>
<p>Set Sht = ActiveSheet</p>
<p>Sht.Range(rowx &amp; ":" &amp; rowx).AutoFilter Field:=colx, Criteria1:="&lt;&gt;" &amp; Itm, Operator:=xlAnd '篩選列,篩選值爲不符合當前省份</p>
<p>Sht.Range(Sht.Cells(rowx + 1, colx), Sht.Cells(StRow, colx)).SpecialCells(xlCellTypeVisible).Delete Shift:=xlUp '刪除被篩選出來的行(刪掉不爲當前省份的行)</p>
<p>Sht.Range(rowx &amp; ":" &amp; rowx).AutoFilter '取消篩選</p>
<p>ActiveWindow.SmallScroll Down:=-StRow</p>
<p>ActiveWindow.SmallScroll ToRight:=-100</p>
<p>If Dir(Wb1.Path &amp; "\拆分\", vbDirectory) = "" Then MkDir ThisWorkbook.Path &amp; "\拆分\" '看看當前文件夾內是否存在"拆分"文件夾,如果沒有就創建一個</p>
<p>Pth = Wb1.Path &amp; "\拆分\" &amp; Itm &amp; "-" &amp; namex &amp; ".xls"</p>
<p>Wb2.SaveAs Filename:=Pth, FileFormat:=xlExcel8, Password:="", WriteResPassword:="", ReadOnlyRecommended:=False, CreateBackup:=False</p>
<p>Wb2.Close '關閉表格</p>
<p>Next</p>
<p>Set Pro = Nothing '釋放變量</p>
<p>Set Wb1 = Nothing</p>
<p>Set Wb2 = Nothing</p>
<p>Set St1 = Nothing</p>
<p>Set Sht = Nothing</p>
<p>Set Rng = Nothing</p>
<p>Set Itm = Nothing</p>
<p>Set StRow = Nothing</p>
<p>Set Pth = Nothing</p>
<p>Application.ScreenUpdating = True '打開屏幕更新</p>
<p>Application.DisplayAlerts = True '打開提示事件</p>
<p>End Sub</p>
<p>Sub 通用發送郵件()</p>
<p>'On Error Resume Next</p>
<p>Dim cm As Variant</p>
<p>UserForm1.Show</p>
<p>UserName = UserForm1.ComboBox1</p>
<p>UserPass = UserForm1.TextBox1.Value</p>
<p>With Application.FileDialog(msoFileDialogFolderPicker)</p>
<p>.InitialFileName = ActiveWorkbook.Path &amp; "\"</p>
<p>If .Show = -1 Then</p>
<p>Pth = Application.FileDialog(msoFileDialogFolderPicker).SelectedItems.Item(1) &amp; "\"</p>
<p>End If</p>
<p>End With</p>
<p>'定義文件夾</p>
<p>Dim FS, F, FF, Fil, BName, EName</p>
<p>Set FS = CreateObject("Scripting.FileSystemObject")</p>
<p>Set F = FS.GetFolder(Pth)</p>
<p>Set FF = F.Files</p>
<p>If FF Is Nothing Or F Is Nothing Then</p>
<p>MsgBox ("文件或文件夾錯誤,請查證在本文件目錄內存在'拆分'文件夾,並且已經生成拆分文件")</p>
<p>Exit Sub</p>
<p>End If</p>
<p>'保存文件信息</p>
<p>Dim FN(1 To 10000, 1 To 3)</p>
<p>i = 0</p>
<p>For Each Fil In FF</p>
<p>i = i + 1</p>
<p>FN(i, 1) = FS.GetBaseName(Fil)</p>
<p>FN(i, 2) = FS.GetExtensionName(Fil)</p>
<p>FN(i, 3) = Left(FN(i, 1), InStr(1, FN(i, 1), "-") - 1)</p>
<p>Next</p>
<p>Set Sht = ThisWorkbook.Sheets("郵件聯繫人")</p>
<p>colnew = Sht.Cells(1, Columns.Count).End(xlToLeft).Column + 1 '聯繫人空白列(用於記錄發送結果)</p>
<p>Sht.Cells(1, colnew).Value = Pth &amp; Chr(10) &amp; Date &amp; " " &amp; Time &amp; " 發送結果"</p>
<p>tex = InputBox("請輸入郵件正文自定義段")</p>
<p>For m = 1 To i</p>
<p>Err.Clear</p>
<p>linkman = ""</p>
<p>emailx = ""</p>
<p>Set bbb = Sht.Range("a:a").Find(FN(m, 3))</p>
<p>If bbb Is Nothing Then</p>
<p>rownew = Sht.Range("a60000").End(xlUp).Row + 1</p>
<p>Sht.Cells(rownew, 1).Value = FN(m, 3)</p>
<p>Sht.Cells(rownew, colnew).Value = "未找到發件人"</p>
<p>mg = mg &amp; FN(m, 3) &amp; Left(" ", 10 - Len(FN(m, 3)) * 2) &amp; "未找到發件人" &amp; Chr(13)</p>
<p>GoTo line5</p>
<p>End If</p>
<p>For n = 1 To Sht.Range("a60000").End(xlUp).Row '循環查找聯繫人姓名和郵件地址</p>
<p>If FN(m, 3) = Sht.Cells(n, 1).Value Then</p>
<p>linkman = linkman &amp; Sht.Cells(n, 2).Value &amp; "、"</p>
<p>emailx = emailx &amp; Replace(Sht.Cells(n, 7).Value, ";", "") &amp; ","</p>
<p>End If</p>
<p>Next</p>
<p>If Len(emailx) &lt; 2 Then '如果郵件地址是空,那就不發送本城市</p>
<p>bbb.Offset(0, colnew - 1).Value = "無郵件地址"</p>
<p>mg = mg &amp; FN(m, 3) &amp; Left(" ", 10 - Len(FN(m, 3)) * 2) &amp; "無郵件地址" &amp; Chr(13)</p>
<p>GoTo line5</p>
<p>End If</p>
<p>linkman = Left(linkman, Len(linkman) - 1) '刪掉最後一個符號</p>
<p>emailx = Left(emailx, Len(emailx) - 1)</p>
<p>Set cm = CreateObject("CDO.Message") '創建對象</p>
<p>cm.From = UserName '設置發信人的郵箱</p>
<p>cm.To = emailx '設置收信人的郵箱</p>
<p>cm.Subject = FN(m, 1) '設定郵件的主題</p>
<p>cm.TextBody = "親愛的 ********：" _</p>
<p>&amp; Chr(10) &amp; " 附件爲 " &amp; FN(m, 1) &amp; "，請查收。" &amp; Chr(10) &amp; tex _</p>
<p>&amp; Chr(10) &amp; "謝謝！" _</p>
<p>&amp; Chr(10) &amp; " _______________________________________________________" _</p>
<p>&amp; Chr(10) &amp; " ** 部門 " _</p>
<p>&amp; Chr(10) &amp; " 姓名 " _</p>
<p>&amp; Chr(10) &amp; " 手機：********* " _</p>
<p>&amp; Chr(10) &amp; " 電話：********* " _</p>
<p>&amp; Chr(10) &amp; " Email：********* " _</p>
<p>&amp; Chr(10) &amp; " 地址：****************** " '郵件正文</p>
<p>cm.AddAttachment Pth &amp; FN(m, 1) &amp; "." &amp; FN(m, 2) '添加附件</p>
<p>stUl = "<a href="http://link.zhihu.com/?target=http%3A//schemas.microsoft.com/cdo/configuration/">http://schemas.microsoft.com/cdo/configuration/</a>"</p>
<p>With cm.Configuration.Fields</p>
<p>.Item(stUl &amp; "smtpserver") = "<a href="http://link.zhihu.com/?target=http%3A//mail.qq.com">http://mail.qq.com</a>" 'SMTP 服務器地址</p>
<p>.Item(stUl &amp; "smtpserverport") = 25 'SMTP 服務器端口</p>
<p>.Item(stUl &amp; "sendusing") = 2 '發送端口</p>
<p>.Item(stUl &amp; "smtpauthenticate") = 1</p>
<p>.Item(stUl &amp; "sendusername") = UserName '發送方郵箱名稱</p>
<p>.Item(stUl &amp; "sendpassword") = UserPass '發送方郵箱密碼"</p>
<p>.Update</p>
<p>End With</p>
<p>cm.Send '發送</p>
<p>'生成反饋信息</p>
<p>If Err.Number = 0 Then</p>
<p>mg = mg &amp; FN(m, 3) &amp; Left(" ", 10 - Len(FN(m, 3)) * 2) &amp; "發送成功" &amp; Chr(13)</p>
<p>bbb.Offset(0, colnew - 1).Value = "發送成功"</p>
<p>Else</p>
<p>mg = mg &amp; FN(m, 3) &amp; Left(" ", 10 - Len(FN(m, 3)) * 2) &amp; "發送失敗" &amp; Chr(13)</p>
<p>bbb.Offset(0, colnew - 1).Value = "發送失敗"</p>
<p>End If</p>
<p>Set cm = Nothing '發送成功後即時釋放對象</p>
<p>line5:</p>
<p>Next</p>
<p>MsgBox (Left(mg, Len(mg) - 1)) '確認結果</p>
<p>End Sub</p>
<p>再貼一個給職場小白</p>
<p>前面拆分，肯定有合併，再貼一個合併工作簿的代碼，也超級簡單的哦。</p>
<p>開始：</p>
<p>新建一個空白工作簿</p>
<p>還是一樣右擊 sheet&mdash;&mdash;查看代碼，這次不用建立模塊，直接把代碼貼進去即可</p>
<img class="content-image" src="http://pic4.zhimg.com/70/04f6b816beb5cdf8610a49425f79a8db_b.jpg" alt="">
<img class="content-image" src="http://pic3.zhimg.com/70/b904327688600619de9843296ba5a86e_b.jpg" alt="">
<p>點擊執行後，讓你選擇文件夾，你的先把要合併的所有工作簿放在一個文件夾內</p>
<img class="content-image" src="http://pic4.zhimg.com/70/c059e349637255764c89c7cc24b2c05b_b.jpg" alt="">
<p>數據是這樣的</p>
<img class="content-image" src="http://pic1.zhimg.com/70/4086ac368d1d05a8a953d4394cfceba8_b.jpg" alt="">
<img class="content-image" src="http://pic4.zhimg.com/70/653284b64373cfafdc5f27d3f37acba3_b.jpg" alt="">
<p>點擊文件夾執行後</p>
<img class="content-image" src="http://pic4.zhimg.com/70/c9284cea7f6c1f5cad55d62ba38605bb_b.jpg" alt="">
<p>按確定後，數據就好了。</p>
<img class="content-image" src="http://pic4.zhimg.com/70/d1aa6458ac8aa452445813fe504a516f_b.jpg" alt="">
<p>對了，工作簿名稱不一樣也不要緊哦</p>
<p>比如這樣&hellip;&hellip;</p>
<img class="content-image" src="http://pic3.zhimg.com/70/bc8bd9142c9359d8ee3b96a32916b5da_b.jpg" alt="">
<p>代碼：</p>
<p>Sub 文件合併()</p>
<p>Application.ScreenUpdating = False</p>
<p>'On Error Resume Next</p>
<p>Dim Pth As String</p>
<p>Set wst1 = ActiveSheet</p>
<p>row1 = 0</p>
<p>wst1.Cells.Delete Shift:=xlUp</p>
<p>'打開文件夾</p>
<p>Dim shell, s</p>
<p>Set shell = CreateObject("Shell.Application")</p>
<p>Set fl = shell.BrowseForFolder(0, "請選擇文件夾", 0, Pth)</p>
<p>If fl Is Nothing Then Exit Sub</p>
<p>Pth = fl.self.Path &amp; "\"</p>
<p>'定義文件夾</p>
<p>Dim FS, F, FF, Fil, BName, EName</p>
<p>Set FS = CreateObject("Scripting.FileSystemObject")</p>
<p>Set F = FS.GetFolder(Pth)</p>
<p>Set FF = F.Files</p>
<p>For Each Fil In FF</p>
<p>BName = FS.GetBaseName(Fil)</p>
<p>EName = FS.GetExtensionName(Fil)</p>
<p>If EName = "xls" Or EName = "xlsx" Or EName = "XLS" Or EName = "XLSX" Then</p>
<p>Workbooks.Open (Fil)</p>
<p>Set wst2 = ActiveSheet</p>
<p>Set wb = ActiveWorkbook</p>
<p>strow = wst2.UsedRange.Rows.Count</p>
<p>If row1 = 0 Then</p>
<p>wst2.Rows("1:" &amp; strow).Copy wst1.Cells(row1 + 1, 1)</p>
<p>row1 = row1 + strow</p>
<p>Else</p>
<p>wst2.Rows("2:" &amp; strow).Copy wst1.Cells(row1 + 1, 1)</p>
<p>row1 = row1 + strow - 1</p>
<p>End If</p>
<p>Application.CutCopyMode = False</p>
<p>wb.Close (False)</p>
<p>End If</p>
<p>Next</p>
<p>MsgBox ("完成")</p>
<p>End Sub</p>
<p>拆分 or 合併 or 羣發郵件，是三個獨立的宏，都可以靈活運用。建議大家複製保存爲 TXT 文檔或者存到一個 Excel 裏面，作爲工具使用，不用每次黏貼複製了。</p>
<p>最後</p>
<p>1、我是女生</p>
<p>2、我早就從那家公司離職了，平時工作忙和妹子沒再聯繫，走之前給她寫了一堆程序，覆蓋她工作中 50% 的 Excel 處理</p>
<p>3、只是同事之間的幫忙，而且我也喜歡研究。爲什麼要扯到感情，大家那麼喜歡童話故事？</p>
<p>4、我不是專業寫 VBA 的</p>
<p>花了兩個小時一個一個截圖 + 寫註釋，你能不能點個贊再走 n(*≧▽≦*)n</p>
</div>
</div>




</div>


</div>
</div>