+++
date = "2017-02-17T11:00:00"
title = "看過這兩張圖，就明白電腦裏的「緩存」是什麼意思"
titleimage = "http://pic2.zhimg.com/0cef747a9ae7742c9bbb7c0e794dd741.jpg"
ga = 021711
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">Cache 和 Buffer 都是緩存，主要區別是什麼？</h2>

<div class="answer">



<div class="content">
<p>倆英文單詞，不先看看本義嗎？雖然都是抽象單詞，但在各個地方都有具象的應用。</p>
<p>Buffer 常見的是這個：</p>
<img class="content-image" src="http://pic4.zhimg.com/70/v2-b7b66d782898210d7bd22439e9238df3_b.jpg" alt="">
<p>（來源：<a href="http://link.zhihu.com/?target=http%3A//www.cepolina.com/train-stop-buffer-bumper.html">train stop buffer bumper</a>）</p>
<p>對，就是鐵道端頭那個巨大的彈簧一類的東西。作用是萬一車沒停住，撞彈簧上減速慢，危險小一些。叫<strong>緩衝</strong>。</p>
<p>Cache 常見的是這個：</p>
<img class="content-image" src="http://pic3.zhimg.com/70/v2-15f852f7456fc701c936075d9174f8ba_b.jpg" alt="">
<p>（來源：<a href="http://link.zhihu.com/?target=https%3A//upload.wikimedia.org/wikipedia/commons/6/68/Bear_caches.jpg">https://upload.wikimedia.org/wikipedia/commons/6/68/Bear_caches.jpg</a>）</p>
<p>沒錯，就是一種保管箱。看到右邊那個被鏽掉的 Food Cache 沒？這是部署在森林裏的存應急物資的保管箱。功能是把你需要用的東西放在更容易拿到的地方。雖然常用準確翻譯叫<strong>緩存</strong>，但個人以爲意思表達的不對，丟了一半的功能。臺灣的翻譯更好，叫<strong>快取</strong>。</p>
<p>相信看完這些應該不用我說區別了？</p>
<p>哎呀還是賣弄一下吧。</p>
<p>簡單說，Buffer 的核心作用是用來緩衝，緩和衝擊。比如你每秒要寫 100 次硬盤，對系統衝擊很大，浪費了大量時間在忙着處理開始寫和結束寫這兩件事嘛。用個 buffer 暫存起來，變成每 10 秒寫一次硬盤，對系統的衝擊就很小，寫入效率高了，日子過得爽了。極大緩和了衝擊。</p>
<p>Cache 的核心作用是加快取用的速度。比如你一個很複雜的計算做完了，下次還要用結果，就把結果放手邊一個好拿的地方存着，下次不用再算了。加快了數據取用的速度。</p>
<p>所以，如果你注意關心過存儲系統的話，你會發現硬盤的讀寫緩衝 / 緩存名稱是不一樣的，叫 write-buffer 和 read-cache。很明顯地說出了兩者的區別。</p>
<p>當然很多時候宏觀上說兩者可能是混用的。比如實際上 memcached 很多人就是拿來讀寫都用的。不少時候 Non-SQL 數據庫也是。嚴格來說，CPU 裏的 L2 和 L3 Cache 也都是讀寫兼用&mdash;&mdash;因爲你沒法簡單地定義 CPU 用它們的方法是讀還是寫。硬盤裏也是個典型例子，buffer 和 cache 都在一塊空間上，到底是 buffer 還是 cache？</p>
<p>不過仔細想一下，你說拿 cache 做 buffer 用行不行？當然行，只要能控制 cache 淘汰邏輯就沒有任何問題。那麼拿 buffer 做 cache 用呢？貌似在很特殊的情況下，能確定訪問順序的時候，也是可以的。簡單想一下就明白&mdash;&mdash;buffer 根據定義，需要隨機存儲嗎？一般是不需要的。但 cache 一定要。所以大多數時候用 cache 代替 buffer 可以，反之就比較侷限。這也是技術上說 cache 和 buffer 的關鍵區別。</p>
<hr>
<p>補充 1：不要誤解 Buffer 就是用來寫的，Cache 就是用來讀的。讀可以用 Buffer 嗎？當然可以，比如你想一批一批地處理讀取而非有啥處理啥的時候，就可以用讀 buffer。寫當然也可以用 cache，比如你的寫入有很高的隨機性的時候。具體什麼場景用 Buffer 什麼場景用 Cache 要根據場景的具體需要決定。</p>
<p>補充 2：不要誤解 Cache 或 Buffer 就一定是內存或者存在什麼高速媒介上的東西。只要相對高速即可。我完全可以在硬盤上存 Cache，比如有些遊戲會在運行時建立預編譯的 shader（暴露年齡），這本質上就是一種 cache，它存在速度緩慢的硬盤上，因爲讀硬盤依舊比重新編譯要快。Buffer 也同理，例如 NTFS 文件系統自己就有 Logging Buffer，這個甚至明確拒絕放在任何易失緩存裏。</p>
</div>
</div>




</div>


</div>
</div>