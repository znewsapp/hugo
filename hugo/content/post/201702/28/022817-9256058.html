+++
date = "2017-02-28T17:00:00"
title = "諸葛亮想和曹操猜拳，可兩人身處異地無法見面"
titleimage = "http://pic1.zhimg.com/c0157fc98e30730e78d2d9a25aa7d6e0.jpg"
ga = 022817
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">



<div class="question">
<h2 class="question-title">用一點密碼學實現遠程猜拳 -- 閒聊 commitment scheme</h2>
<div class="answer">



<div class="content">
<p>小時候和夥伴一起猜拳定勝負的場景還歷歷在目吧？記得當時往往因爲&ldquo;慢出&rdquo; 產生爭執。 解決爭執的方法通常是重新猜拳，或者是找第三個小夥伴來仲裁。然而這些方法有着本質上的侷限， 因爲沒有任何辦法能保證兩個人<strong>完全</strong>同時出拳：在猜拳高手的眼中，即使晚出 0.01 秒， 也可以觀察到對手的動作，克敵制勝！不過這並不是一篇武俠小說，所以我們今天討論的話題是: 如何完成<strong>公平</strong>的猜拳？！？</p>
<p><strong>兩人可以見面</strong></p>
<p>一個最簡單的解法是： 每人把自己的決定（石頭，剪刀，布）寫到一張紙上。再裝進一個信封裏。然後兩人見面，把信封拆開。這樣就無法改變自己的決定了。這樣的猜拳結果是完全公平的，因爲決定已經裝在信封裏，就無法再更改了！</p>
<p>三國演義中， 諸葛亮和周瑜商量赤壁之戰的對策，各在手中寫一個&ldquo;火&rdquo; 字，使用的是同樣的方法。諸葛亮在這裏有兩個目標：要傳達給周瑜自己火攻的計策，同時又想測試一下週瑜是否也想到火攻。周瑜的想法也一樣：既要傳達這個計策，又想測試對方的能力。這樣一來，兩方產生了一個有趣的小博弈，看一段原文：</p>
<blockquote>瑜邀孔明入帳共飲。瑜曰：&ldquo;昨吾主遣使來催督進軍，瑜未有奇計，願先生教我。&rdquo;孔明曰：&ldquo;亮乃碌碌庸才，安有妙計？&rdquo;瑜曰：&ldquo;某昨觀曹操水寨，極其嚴整有法，非等閒可攻。思得一計，不知可否，先生幸爲我一決之。&rdquo;孔明曰：&ldquo;都督且休言。各自寫於手內，看同也不同。&rdquo; 瑜大喜，教取筆硯來，先自暗寫了，卻送與孔明。孔明亦暗寫了，兩個移近坐榻，各出掌中之字，互相觀看，皆大笑。原來周瑜掌中字，乃一&lsquo;火&rsquo;字，孔明掌中，亦一&lsquo;火&rsquo;字。瑜曰：&ldquo;既我兩人所見相同，更無疑矣。幸勿漏泄。&rdquo;孔明曰：&ldquo;兩家公事，豈有漏泄之理？吾料曹操雖兩番經我這條計，然必不爲備。今都督盡行之可也。&rdquo;飲罷分散，諸將皆不知其事。</blockquote>
<p>這裏周瑜和諸葛亮掌心寫字的方法和使用信封是異曲同工的。</p>
<p><strong>兩人不能見面</strong></p>
<p>現在我們把難度提高一點: 諸葛亮想和曹操猜拳，但是兩人身處異地無法見面。這種情況下如何保證公平呢？</p>
<p>如果諸葛亮把自己的信封用快馬送給曹操，那曹操可以拆開看到諸葛亮的出拳之後再寫自己的信。所以之前的解法就失效了。信封這個解法不行了，不過如果用一點密碼學，還是可以異地猜拳。我們假設諸葛亮有一個抵抗衝撞的哈希函數(collision-resistant hash function) f(x)，滿足如下的條件：</p>
<p>(1) 從 x 很容易計算 f(x)。</p>
<p>(2) <strong>非常難</strong>找到兩個 x, y 滿足 f(x) = f(y).</p>
<p>諸葛亮先確定一個選擇 m {石頭，剪刀，布} 。然後再選擇一串隨機數 r, 把自己的承諾 y = f(r , m) 發給曹操。曹操同樣把自己的&ldquo;承諾" y' 發給諸葛亮。</p>
<p>諸葛亮等自己收到曹操的承諾 y'以後，再把隨機數 r 和自己的出拳 z 發送過去。曹操等收到承諾之後，做同樣的事。</p>
<p>曹操通過計算 f(r, m) = y 來確保諸葛亮沒有作弊。</p>
<p>現在雙方可以比較彼此的出拳，來決定誰勝誰負！問題是: 爲什麼這樣可以杜絕一方作弊？</p>
<p>假設諸葛亮想要作弊，那他必須在收到曹操的所有信息之後再發送（r,z）。現在假設諸葛亮想把自己的出拳改成 m' , 那麼他必須找到另一個隨機數 r'，滿足</p>
<blockquote>f(r , m) = f(r', m').</blockquote>
<p>然而！根據對函數 f 的假設，在有生之年諸葛亮是找不到 r' 的。所以他沒有辦法作弊：任何他能找到的 r', 曹操計算出的承諾 f(r',m') 都和 y 對不上，所以曹操能看出他有沒有&ldquo;慢出&rdquo;！</p>
<p><strong>承諾系統 (Commitment Scheme)</strong></p>
<p>上面介紹的&rdquo;公平的遠程猜拳&ldquo;方法用到的實際是密碼學的一個重要原型 Commitment Scheme。它起源於兩篇文章： 1979 年 Blum 的 coin flipping over the telephone （如何通電話猜硬幣）和 1981 年 RSA 三巨頭的 Mental Poker （如何通電話玩撲克）。可以看出來，commitment 最大的優勢是用來遠程進行公平的博弈，而不需要一個第三方裁判的存在。</p>
<p>這裏再介紹一個經典的應用場景：假設一件古董的買方和賣方的出價底線分別是 a 元和 b 元，他們希望達成如下的協定：如果 a &lt; b，那麼交易失敗；如果 a &gt;= b， 那麼交易在中間價格 (a + b)／2 上成交。</p>
<p>這個看似簡單的合同怎麼在實際生活中執行呢？當然買家不能把自己的底線 a 透露給賣家，因爲如果 a &gt; b，那麼賣家可以出價 a, 從而在高位成交；反之也同理。如何隱藏自己的底線價格呢？用 commitment！原理和之前的異地猜拳完全一樣。就是買賣雙方(1) 先公開自己出價的 commitment，然後(2) 公開價格。由於 commitment 具有隱藏性，所以在步驟（1）之後雙方都無法推測對方的價格；又由於 commitment 具有不可更改的特性，所以任何一方都無法在步驟（2）中更改自己之前承諾（commit) 的價格 !</p>
<p><strong>爲何不用微信猜拳？</strong></p>
<p>看到這裏肯定有人要問了： 那微信猜拳呢? 它比上面的用 commitment 的解法簡單粗暴多了：我可以直接發送一個猜拳的表情，然後這個表情會隨機變化成石頭剪刀布中的一個。爲什麼還需要引入承諾系統呢？</p>
<p>其實最大的不同在於：微信在猜拳裏扮演的是一個 <strong>公正的第三方，</strong> 即對話的雙方需要都信任微信不會作弊<strong>。</strong>其實在有公正的第三方存在的情況下，上面提到的所有問題都可以簡單解決。從之前那個古董買賣的例子來看，如果有一個買賣雙方都信任的交易行，那麼他們只需要把自己的報價 a,b 提交給交易行，交易行作爲一個誠實可靠的機構，會誠實的比較報價並得出最終結論。</p>
<p>然而這個公正第三方往往不是免費的：無論是法官，交易中介，古董拍賣行，都是收取手續費的。 而且這些第三方也不是百分之百可以信任：他們有可能和博弈雙方的其中一邊合作，來損害另一邊的利益。</p>
<p>而上面的通過 commitment 來博弈的方法是不需要公正第三方的！這也是爲什麼它在現代密碼學中的應用如此的廣泛。比如</p>
<p><em> 數字貨幣（參見舊文 <a class="internal" href="https://zhuanlan.zhihu.com/p/25168970">Zerocash: 數字貨幣領域的暗科技</a> ） </em></p>
<p><em> 多方計算</em></p>
<p><em>零知識證明</em></p>
<p>等等...都是以後可以展開聊很多的話題，今天就先到這裏吧。</p>



</div>
</div>
</div>


</div>
</div>