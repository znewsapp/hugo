+++
date = "2016-12-11T07:00:00"
title = "網絡太「卡」了，該怎麼辦？"
titleimage = "http://pic3.zhimg.com/0bc272174989545654b07a69c776ca46.jpg"
ga = 121107
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title"></h2>

<div class="answer">



<div class="content">
<p>這個問題太寬泛了，個人覺得沒有能力答好，只說說我自己的一些看法。</p>
<p><strong>在進行任何排查前，最重要的事情是要明確故障現象。</strong></p>
<p><strong>現假設我們面臨的問題是訪問公網上一臺 FTP 服務器，下載速度很慢，很卡。（注意：我沒有假設故障現象是上網打開網頁慢，是因爲除了網絡可能導致慢以外，還有很大部分原因是瀏覽器本身、頁面加載的某些鏈接、某些不合理的 js 等太多可能）</strong></p>
<p>我在面對這種問題時，基本都會採用排除法。思路也很簡單，將整條訪問鏈路分成多個部分（PC 本身，PC-- 網關，網關 -- 公網出口，公網出口 -- 目標 FTP 服務器）。</p>
<p>一：需要排查 PC 本身的問題，比如 CPU 利用率高、機器本身反應很慢等情況。</p>
<p>二：先進行第一輪排查法，用 ping 初略排查（如果 PC 操作系統是 linux 就更好了，可以用快速 ping，windows 還想安裝軟件）。</p>
<p>1）ping 網關</p>
<p>2）ping 公司互聯網出口(運營商端地址)</p>
<p>3）ping 目標 FTP 服務器</p>
<p>如果以上能發現丟包異常、網絡時延過大、網絡時延抖動大，就以此爲基礎逐段細分排查。（少數情況下，會出現 ping 目標服務器不丟包，但 ping 運營商中途地址丟包。這時更應該關注對最終目標服務器的 ping 結果，可採用快速 ping，大包 ping 的方式來驗證到最終服務器的通信質量，嘗試多次仍然不丟包，可忽略運營商中途的丟包情況）</p>
<p>如果以上沒有發現異常，就採用快速 ping，打包 ping 來進一步檢查所有環節。</p>
<p>三：如果經過上面兩步，還沒有發現任何問題的跡象。</p>
<p>如果條件允許的話，我會選擇一個容易操作的環節上抓包，可以在 PC 上、也可以在交換上，也可以在出口路由器上。</p>
<p>如果條件不允許的話，我就會登陸到數據路徑上的交換機、路由器逐級檢查接口狀態和流量情況。看是否能發現流量過大、廣播包漲的過快、接口上有 error、接口上有 drop 等。</p>
<p>如果還是沒有發現異常，我會嘗試換一臺 PC 來測試。</p>
<p>如果新 PC 仍然出現訪問 FTP 慢或下載慢的情況，那我就必須通過抓包來判斷故障。</p>
<p>四：進入抓包排障環節</p>
<p>如何好好利用抓包工具就是很重要的問題了，假設採用 wireshark 抓包。</p>
<p>抓包排障絕大部分時候，其實都只有看是否有丟包。</p>
<p>1）首先看看是否存在大量丟包</p>
<p>2）如果丟包不多，可以利用 wireshark 統計流量圖形，看看是否存在規律的波峯波谷，或較平坦穩定的流量圖像，可能通信環節或最終 FTP 服務器有帶寬限制。</p>
<p>3）如果還沒有發現特別異常，就需要對抓包數據的特徵進行分析。比如通信的數據包都很小，比如所有數據包基本都是一來一回交替傳輸等等，到了這裏很大可能就是和對方 FTP 服務器 TCP 協議棧、或者是 FTP 客戶端和 FTP 服務器的兼容性問題了。可以換一個不同 FTP 客戶端軟件，或另外一個不同的操作系統版本來測試</p>
<p>以上所有都來自與假設，實際中的故障或者簡單，或者複雜，具體情況還需具體分析。<strong>總思路就是排查法，逐段排查。</strong></p>
</div>
</div>




</div>


</div>
</div>