+++
date = "2016-12-03T19:00:00"
title = "用亞當和夏娃的故事，來解釋一下傳輸協議"
titleimage = "http://pic4.zhimg.com/2b56f5a377ee29ed76a54c066fe2c4bf.jpg"
ga = 120319
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">怎麼理解 TCP 的面向連接和 UDP 的無連接（不面向連接）？</h2>

<div class="answer">



<div class="content">
<img class="content-image" src="http://pic1.zhimg.com/70/2c2740ba915faea09bf265c9cfd92c44_b.jpg" alt="">
<p>亞當和夏娃分別生活在兩個山頭，山頭之間是萬丈深淵，亞當採集野果需要分享給夏娃，如果他們之間有一條索道（<strong>物理連接</strong>），野果可以順着索道滑到夏娃那一邊，那就沒有車小胖什麼事了。</p>
<p>事實上山頭之間沒有索道，但是亞當何等聰明，於是他想出了一個方法，假設亞當需要給夏娃 10 個野果，否則她會餓死。</p>
<p><strong>連接建立</strong></p>
<p>亞當對着夏娃大喊：愛妃，你聽得到嗎？</p>
<p>夏娃迴應：孩他爹，我聽得到！</p>
<p>亞當接着喊：那好，我扔果子給你吃，你接到果子就喊一聲，一共十個。</p>
<p><strong>運送貨物</strong></p>
<p>於是亞當開始扔第一個，夏娃喊收到了一個。</p>
<p>亞當扔第二個，夏娃喊收到兩個。</p>
<p><strong>超時重傳 （ timeout retransmit)</strong></p>
<p>亞當扔第三個，可是夏娃遲遲沒有迴音，亞當意識到可能果子落到懸崖了，於是重新扔，夏娃喊收到第三個。</p>
<p><strong>Advertised window size = 0</strong></p>
<p>於是亞當連續扔了第四、五、六個，夏娃急了：孩他爹，慢點扔，臣妾忙不過來了&hellip;</p>
<p><strong>Advertised window size &gt; 0</strong></p>
<p>於是亞當坐下休息，愛妃又開始叫了：繼續扔吧。</p>
<p>亞當開始扔第七個，夏娃喊收到七個。</p>
<p>&hellip;&hellip;</p>
<p><strong>關閉連接</strong></p>
<p>終於亞當扔完了，亞當喊：愛妃，果子扔完了，寡人去忙別的了。</p>
<p>夏娃回覆：好的，我也休息一下，再見</p>
<p>亞當：再見</p>
<p>以上的過程類似 TCP 連接的過程，TCP 是一個虛擬連接。</p>
<p><strong>何爲虛擬連接？</strong></p>
<p>和物理連接所對應，物理連接是實實在在存在的，看得見摸得着，比如索道。而虛擬連接是不存在的，看不見摸不着，通過雙向的消息、消息確認來模擬物理連接。</p>
<p>由於有確認機制，亞當可以確保夏娃可以收到 10 個果子。</p>
<p><strong>那接下來再談談什麼是無連接的 UDP？</strong></p>
<p>亞當和夏娃吵架了，任憑亞當如何大聲喊，夏娃躲在樹林後生悶氣，一聲不響，亞當害怕夏娃餓死，於是開始自說自話朝着夏娃的山頭扔玉米棒子：</p>
<p>一個、兩個、三個&hellip;&hellip;</p>
<p>一共扔了十個，但最終扔到對方山頭到底有幾個，亞當沒有底，也許有的玉米棒子落到懸崖了，但是這個效率高啊，可以連續扔，以前扔 10 個果子需要一分鐘，現在只需要 20 秒。</p>
<p>亞當扔果子、扔玉米都有可能扔到懸崖下，但是扔果子爲何可以確保對方收到十個？那是因爲夏娃收到一個果子，然後喊收到了，如果沒有收到，亞當就重新扔，直到夏娃說收到了。而扔玉米棒子對方沒有確認，所以對於丟棄的情況無法知道，也無法重新扔。</p>
</div>
</div>




</div>


</div>
</div>