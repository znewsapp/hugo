+++
date = "2017-05-24T13:00:00"
title = "在 5 個人不告知各自薪水的情況下，怎麼求平均工資？"
titleimage = "https://pic1.zhimg.com/v2-8a578c1bcea63606270da6011dfbb734.jpg"
ga = 052413
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title"></h2>

<div class="answer">

<div class="content">
<p>解題要求：使用數學方法、不能借助第六人、選用的方法有一定防止作弊和少數人串通的能力。</p>
</div>
</div>


</div>





<div class="question">
<h2 class="question-title"></h2>

<div class="answer">



<div class="content">
<p>每個人把自己的工資隨意拆成四個數的和，分別把四個數字告訴自己以外的四個人； 每個人手裏收到四個數字，加起來，報出； 五個人的數字相加，即可得到五個人的總收入，除以 5 得到平均工資。</p>
<p>記得這是一個挺古老的解決方案？</p>
<hr>
<p>有評論說我說的不夠清楚，那可以這麼再嚴格地敘述一下：</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=a_1%2Ca_2%2Ca_3%2Ca_4%2Ca_5" alt="">
<p>現在得到一個矩陣：</p>
<img class="content-image" src="http://pic1.zhimg.com/70/v2-0576f11afef77e38752fb3fdcf0d4b68_b.jpg" alt="">
<p>第二步就相當於計算每一列的和，然後第三步把它們加起來再除以五。總體上就是說矩陣所有元素的和等於各行和之和，也等於各列和之和。</p>
<p>總結一下評論區一些討論：</p>
<ol>
<li>如果考慮剩餘四個人抱團的情況，四個人可以採用同樣的辦法，在互相不告訴薪水的情況下得知四人的總薪水，從而得知第五人的薪水。</li>
<li>每個人把工資分成五份，自己留一個數字只能讓其餘四個人不能直接把手裏的關於他的數字相加得到他的薪水，對防禦四人抱團的情況沒有幫助。</li>
<li>拆分的數字可以取負數，從而讓其餘人失去了薪水的一個下界的信息。</li>
</ol>
<p>這個方法不是我原創的，應該是近幾年在某一本書上看的，但是翻了翻沒找到；也有可能是數學建模或者密碼學課上老師提到過。</p>
</div>
</div>

<div class="answer">



<div class="content">
<p>作爲一個密碼學學渣，這個問題引起了我極大的興趣，想從相對專業一點的角度聊一聊。答案較長，分爲以下幾個部分：第一部分介紹一些基本概念和討論的大前提，第二部分分析目前知友們提出的方案，第三部分基於一位知友的答案進行改進，第四部分討論幾何均值的情況，第五部分總結。</p>
<p><strong><strong>一、介紹</strong></strong></p>
<p>在一個有信息需要保密的過程中，我們應該如何考慮消息的安全性？主要分爲兩個方面：</p>
<p>第一是消息的保密性。也就是說，要儘量保證不該知道這個消息的人不能知道與消息相關的信息（注意是信息而非內容。內容是指完整地掌握所有的信息，而信息則是與之相關的東西，比如最後一個比特，二進制中 1 的個數等等。這些信息的泄露也是需要避免的）。</p>
<p>第二是消息的可靠性。也就是說，A 收到了 B 發出的消息，他應該有辦法驗證這條消息確實是 B 發出的，而不是中間人掉包後的消息。</p>
<p>在研究一個協議的安全性時，我們經常構造一個&ldquo;遊戲（game）&rdquo;，遊戲中有兩方：敵手和挑戰者。挑戰者進行保密通信，而敵手則需要竊取祕密或破壞通信。根據不同的假設，我們給予敵手一些能力，同時對通信消息的保密性和可靠性做一些要求。最後，我們考慮在面對有這種能力的敵手時，需要的保密性和可靠性是否能夠達到要求。</p>
<p>具體到這個問題中，我們先討論一些大前提，再討論其他知友給出的方案的安全性，構造一些攻擊，最後提出一個相對來說安全性較高的方案。爲了一般性，我們直接討論 n 個人的情況。</p>
<blockquote><strong>大前提 1</strong>：所有的節點必須是誠實的。也就是說，每個人提供自己的工資信息時不能撒謊。</blockquote>
<p>說明：這是一個很不現實但又必須做的假設。原因很簡單：如果有且只有一個節點撒謊，那麼他將獲得其他四個人的平均工資，同時其他四個人不知道五個人的平均工資，且完全無法驗證；如果有至少兩個人撒謊，那麼沒有人可以同時知道所有人的平均工資。無論如何，整個協議將變得沒有意義。</p>
<blockquote><strong>大前提 2</strong>：最壞的情況下只有 n-2 個節點進行合謀，攻擊其餘兩個節點。</blockquote>
<p>因爲如果 n-1 個節點攻擊另外一個節點，無論如何都一定成功。（注： n-1 個節點如果可以合謀，可以在這 n-1 個節點不泄露自己工資的情況下得到剩下一個人的工資，這是一個遞歸的過程。簡單起見，我們不允許這樣的攻擊。雖然 @Pegasus 的答案討論了這樣的攻擊）</p>
<blockquote><strong>大前提 3</strong>：他們只能靠互相交流信息來獲得答案。</blockquote>
<p>也就是說，沒有一個可信第三方來幫助計算。這個要求否決了找會計等答案。</p>
<p><strong><strong>二、方案分析</strong></strong></p>
<p>下面我們分析一些知友提出的方案的安全性。</p>
<p><strong>1. 撲克牌 / 麻將 / 大富翁鈔票</strong></p>
<p>在這些知友的方案中，每個人通過撲克牌等將自己的工資信息拆分，之後混在一起加起來求平均。由於這些牌是扣起來混合的，因此不可能知道其他人的工資。</p>
<p>分析：這個方法在大多數情況下可以保證自己的工資不被其他人所知，但一定會有信息泄露。比如說我們用紅桃代表千位，你看到翻開後的牌裏有一個紅桃九，而你自己的工資只有一千多，矛盾是不是就產生了？但是如果是理想情況，你只能知道最後的平均工資，而不能知道每一個人工資的任何信息。</p>
<p>由於這個方案泄露了大家工資的信息，因此不可靠。</p>
<p><strong>2.第一個人加上一個隨機數，最後減掉</strong>（<a href="https://www.zhihu.com/question/60042833/answer/173221097">這個答案</a>）</p>
<p>這樣的方式是符合最基本的安全要求的。也就是說，如果每個人都只知道自己的工資和傳來的數字，沒有人可以知道其他人的工資。</p>
<p>分析：這個方案几乎沒有直接泄露的信息，但少數人合謀可以對某個人的工資數進行攻擊。如果第一個人知道了第三個人收到的數字，他就可以知道第二個人的工資；2 號知道了 4 號收到的數字，就知道 3 號的工資&hellip;&hellip;對於任意一個 n ，只需要知道前後的數字就可以算出一個人的工資，這個協議還是比較脆弱的。</p>
<p><strong>3.每個人拆分自己的工資併發給其他人</strong>（<a href="https://www.zhihu.com/question/60042833/answer/173025969">這個答案</a>）</p>
<p>在這種情況下，任意 n-2 個人合謀也只能得到其餘兩人的平均工資，無法獲得更多的信息。這是目前最好的方案。</p>
<p>但是注意，這個方案我們進行了一些假設：每個人發給其他人的信息不會被這 n 個人之外的敵手竊聽，也不會被篡改。但實際中並不是這樣。我們的方案應該能防止這些事情的發生。</p>
<p>下面，我們提出這個問題中的敵手能力和安全性要求，並對方案 3 做出改進來滿足我們提出的要求。</p>
<p><strong>三、方案改進</strong></p>
<p>現在我們假設這 n 個人不在一起，彼此之間只能通過計算機發送信息。而通信的信道是不可靠的，也就是說我們不能驗證這條消息是不是對方發來的、沒有被篡改過的，傳輸的信息也會被敵手得到。</p>
<p>而我們的要求包括兩方面。第一，這 n 個人中即使有 n-2 個人合謀，也只能知道剩下 2 人的平均工資，不能獲得更多的信息；第二，敵手即使可以獲得所有的通信消息，也可以進行篡改。在這種情況下，敵手不能獲得關於工資的任何信息，也不能篡改通信內容而不被發現。</p>
<p>在這裏我們還要再做兩點補充。第一是敵手的計算能力是有限的，這允許我們進行公鑰加密和簽名（這兩個概念馬上會具體介紹）；第二是公開信息是可靠的，也就是說，我可以公開一個字符串作爲我的一個&ldquo;公鑰&rdquo;，這個公鑰沒有保密性，任何人都可以看到。而這種情況下這個字符串是無法僞造的，也就是所有人都可以確定我確實公開的是這段字符串。</p>
<p>下面我們分別介紹公鑰加密和數字簽名。在傳輸中的消息是會被敵手看到的，所以要對消息進行加密。但如果使用傳統的加密方式，需要加密者和解密者擁有共同的密鑰，在這種情況下是做不到的（不考慮密鑰交換&hellip;&hellip;這個過程還是用公鑰思想實現的）。因此我們需要使用另一種加密方式：加密密鑰是公開的，每個人都可以看到並使用；但解密密鑰是保密的，只有消息的接受者持有。這樣，當 Alice 想給 Bob 發送一條保密消息時，他只需要使用 Bob 的公鑰對消息進行加密再發給 Bob ，Bob 使用解密密鑰進行解密即可。</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=g%5Ex%3Dy" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=x%3D%5Clog+_g+y" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=g%5Ea%2Cg%5Eb" alt="">
<p>這樣，我們就可以構造一個公鑰加密體制，也就是著名的 ELGamal ：</p>
<blockquote>1.Bob 找一個羣（比如 <img class="content-image" src="http://www.zhihu.com/equation?tex=%5Cmathbb%7BZ%7D_q%5E%2A" alt=""> ）和一個生成元 <img class="content-image" src="http://www.zhihu.com/equation?tex=g" alt=""> ,私鑰爲 <img class="content-image" src="http://www.zhihu.com/equation?tex=x" alt=""> ，公開 <img class="content-image" src="http://www.zhihu.com/equation?tex=h%3Dg%5Ex%2Cg%2Cq" alt=""> ，保密 <img class="content-image" src="http://www.zhihu.com/equation?tex=x" alt=""> . 2.Alice 先隨機選擇一個數 <img class="content-image" src="http://www.zhihu.com/equation?tex=y" alt=""> ，然後分別計算 <img class="content-image" src="http://www.zhihu.com/equation?tex=c_1%3Dg%5Ey" alt=""> 和 <img class="content-image" src="http://www.zhihu.com/equation?tex=c_2%3Dm%5Ccdot+h%5Ey" alt=""> ,將其發送給 Bob. 3.Bob 計算 <img class="content-image" src="http://www.zhihu.com/equation?tex=c_2%2Fc_1%5Ex" alt=""> ，可以驗證其等於 <img class="content-image" src="http://www.zhihu.com/equation?tex=m" alt=""> ,解密成功。 （這裏的描述不是很嚴謹，大家理解意思即可）</blockquote>
<p>下面我們介紹數字簽名。在現實生活中，我們經常需要對文件進行簽名，證明我們已經閱讀並認可該文件。類似地，在數字世界中，我們也需要對文件進行簽名。簽名可以防止信息的僞造：因爲我們提到了，每個人可以公開一個字符串，這個字符串是可靠的，所有人都可以驗證它屬於你。類比公鑰，你把一個消息用你的私鑰進行處理，得到的值任何人都可以用你的公鑰進行驗證，這就達到了目的。</p>
<p>類似地，ELGamal 同樣可以進行簽名的構造。比如 Alice 要對消息 m 進行簽名：</p>
<blockquote>sAlice 隨機選擇 k 計算 <img class="content-image" src="http://www.zhihu.com/equation?tex=r%3Dg%5Ek%5Cpmod%7Bq%7D" alt=""> 和 <img class="content-image" src="http://www.zhihu.com/equation?tex=%28m-xr%29%2Ak%5E%7B-1%7D%5Cmod+%7Bq-1%7D" alt="">dsis<br>Bob 驗證 <img class="content-image" src="http://www.zhihu.com/equation?tex=%28m-xr%29%3Dy%5Er%5Ccdot+r%5Es+%5Cpmod%7Bq%7D" alt=""><br>（公式顯示不出來的話可自行搜索相關內容）</blockquote>
<p>其實具體的方法不重要，大家只要知道有一種方法，可以驗證一條消息是不是由某個人發送的就行了。</p>
<p>好了，下面我們完整地過一遍：</p>
<p>1.每個人的工資分別記爲</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=m_1%2Cm_2%2C%5Cldots%2Cm_n" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=m_%7B11%7D%2Cm_%7B12%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=i" alt="">
<p>4.每個人驗證簽名後用自的私鑰解密其餘 n-1 條消息，將其與自己留下的一個數共 n 個數求和</p>
<p>5.把求和結果用其餘 n-1 個人的公鑰分別加密，並對結果簽名，將加密後的消息與對應的簽名發送給對應的人</p>
<p>6.每個人驗證簽名後解密所有消息，計算平均值即可</p>
<p><strong>四、幾何均值</strong></p>
<p>在第三部分最後，我們已經給出了所有人算術平均值的方案，可以證明在加密算法和簽名算法安全的情況下，這種方案也是足夠安全的。下面我們討論求幾何均值的情況。</p>
<p>如果用類似的方法，我們需要把每個數分解爲若干個數的乘積，這是很難做到的。一方面，對整數進行素因子分解本身就不是一件容易的事情；另一方面，有些整數沒有足夠的素因子，將 1 作爲因數之一併不是一個好辦法。</p>
<p>看來只有另尋出路了。注意到 ELGamal 加密算法中的消息是作爲一個因子的，這給了我們一個提示。構造這樣的算法：</p>
<img class="content-image" src="http://www.zhihu.com/equation?tex=%5Cmathbb%7BZ%7D_q%5E%2A" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=c_1%3Dm_1%5Ccdot+h_1%5E%7Br_1%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=c-2%3Dc_1%5Ccdot+m_2+%5Ccdot+h_2%5E%7Br_2%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=p_1%3Dp_0%2Fg_1%5E%7Br_1x_1%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=p_2%3Dp_1%2Fg_2%5E%7Br_2x_2%7D" alt="">
<img class="content-image" src="http://www.zhihu.com/equation?tex=q" alt="">
<p>關於可靠性只需要再加一個簽名即可，不再贅述。</p>
<p><strong>五、總結</strong></p>
<p>這個看起來很簡單的問題，深究起來竟然涉及如此多的密碼學知識，連我都有些驚訝。這也是我們思考問題的方式：假設每個環節都有泄密或被篡改的可能，然後逐個去排除，讓協議更加安全可靠。</p>
<p>第二部分第三個方案是一個很不錯的方案，不僅泄露的信息最少，而且很容易類比到任意人數的情況。因此很容易想到在此基礎上進行修正。而第四部分純粹是我突然想到的，畫蛇添足了。</p>
<p>事實上，問題本身是一個最簡單的安全多方計算問題，有興趣的朋友可以順着這個關鍵詞查閱相關的資料。</p>
<p>最後我想說，<strong>密碼學真的很好玩~</strong></p>
</div>
</div>




</div>


</div>
</div>