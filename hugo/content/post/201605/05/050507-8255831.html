+++
date = "2016-05-05T07:00:00"
title = "解密「從根兒上幹掉你」的黑客攻擊"
titleimage = "http://pic3.zhimg.com/6f61d346129e14c1b88e47b850d35f6a.jpg"
ga = 050507
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">



<div class="question">
<h2 class="question-title">從根兒上幹掉你：固件和物理攻擊（上）——攻擊技術</h2>
<div class="answer">



<div class="content">
<p>這次簡單一點，給大家帶來另一個 Black Hat 2014 聽譯的視頻：《Protecting Data In-Use from Firmware and Physical Attacks》。我自己不是做物理安全的，對這個領域並不是很熟悉。不過，視頻中提到的很多攻擊手段讓我覺得真是腦洞大開&hellip;&hellip;這幫黑帽子們真是無所不用其極啊。反過來，魔高一尺，道高一丈，白帽子們也不是吃素的，各種解決方案也相繼出臺。這篇專欄中，我們來簡單看下，在固件和物理層有哪些攻擊行爲。至於具體防護措施，留個坑，後面有時間繼續總結。</p>
<ul>
<li>視頻 YouTube 原始鏈接：<a class=" external" href="https://link.zhihu.com/?target=https%3A//www.youtube.com/watch%3Fv%3DedNkIc6L9Qo" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">youtube.com/watch?</span><span class="invisible">v=edNkIc6L9Qo</span><span class="ellipsis"></span></a></li>
<li>中英雙語字幕鏈接（i 春秋平臺，現在免費的課程不需要註冊了，鼓掌撒花！）：<a class=" wrap external" href="https://link.zhihu.com/?target=http%3A//www.ichunqiu.com/section/1443" target="_blank" rel="nofollow noreferrer">針對固件和物理攻擊的數據保護課程詳情</a></li>
<li>聽寫、翻譯：<a class="member_mention" href="https://www.zhihu.com/people/d543743c88797978a0a8c453f8768974">@劉巍然 - 學酥</a> 。這個視頻比較短，我就自己搞定了&hellip;</li>
<li>時間軸、校對、壓制：<a class="member_mention" href="https://www.zhihu.com/people/3e008eeed2acb09f3dcf3d66a214ab2c">@吳詩湄</a> 。御用時間軸啊，活好，不粘人！</li>
</ul>
<p>0 前言</p>
<p>現在這個時代，組裝個臺式機已經不是個難事了。有點經驗的人，打開臺式機一看，估計就知道里面哪個部分是幹什麼用的了。什麼顯卡啊、聲卡啊、網卡啊、CPU 啊，一目瞭然。不過，在服務器中可就不是那麼回事了。先來個圖，<strong>誰能告訴我這都是什麼服務器？這都是服務器的什麼部分？</strong></p>
<img class="content-image" src="https://pic1.zhimg.com/9ae0dab8ea43ef5752d4ac08444e4044_b.jpg" alt="">
<p>估計大家都不太清楚&hellip;實際上，左邊的圖是：</p>
<img class="content-image" src="https://pic2.zhimg.com/0a6a131e87b84dfb486851f2024aed09_b.jpg" alt="">
<p>而右邊的圖是：</p>
<img class="content-image" src="https://pic3.zhimg.com/22b2c67186adabed4fd6bb66a384dc2e_b.jpg" alt="">
<p>畫紅色圈的地方都是惡意設備。這玩意，非專業人士完全看不出來啊&hellip; 對了，就是因爲看不出來，這東西才能默默地安裝在服務器上，用於竊取用戶數據的。有的知友們說了：我們不怕，密碼學保護我們！不過，這裏面有個很直接也很簡單的問題，密碼學確實能保護數據隱私，但是解密的時候你怎麼也得輸入密碼吧？解密過程總得在計算機中運行吧？舉個簡單的例子，很多瀏覽器都支持&ldquo;記住密碼&rdquo;功能，不過有誰知道瀏覽器是怎麼記住密碼的嗎？來看個簡單的例子，這是谷歌瀏覽器對於我網頁中密碼的存儲情況：</p>
<img class="content-image" src="https://pic3.zhimg.com/f447b456d1caac8c4df7564931ccae36_b.png" alt="">
<p>好吧&hellip;請允許我對圖片處理一下，只留個郵箱。好傢伙，點擊【顯示】，密碼全都顯示出來了啊！</p>
<ul>
<li>谷歌不是號稱厲害嗎？這問題都解決不了？谷歌說了：如果你電腦能讓外人使用，那這個外人也是可以信任的啊，有什麼問題？</li>
<li>那不行，不能這麼存！谷歌說了：那好啊，登錄了我才存你密碼，你密碼用登錄的密碼加密，行不？</li>
</ul>
<p>但是，用的時候還是要把密碼恢復出來才能填寫在表單裏面。那攻擊者樂呵了，只要密碼被恢復出來過，那就好辦！怎麼辦呢？我們來總結下視頻中列舉的方法吧。</p>
<p>1 Boot Integrity Attack</p>
<img class="content-image" src="https://pic2.zhimg.com/be8cd514f0e8a6279b2c625b22e17589_b.jpg" alt="">
<p>服務器或者計算機啓動的時候，我就開始搞你！方法很簡單。想必有知友們用過老毛桃等工具吧？系統啓動不了的時候，用這個工具就能重裝系統，對電腦修復什麼的。</p>
<p>不過不知道大家注意過沒有，這種工具還有一個功能：重置計算機登錄口令。這是怎麼做到的呢？很簡單。反正你從 U 盤啓動了對吧？U 盤啓動了，電腦就得聽 U 盤裏面操作系統的話了，U 盤裏面的操作系統可以任意添加、修改、刪除硬盤裏面的東西，當然也包括操作系統文件嘍。只要我把操作系統中存放用戶密碼的文件重置了，密碼也就沒了。</p>
<p>不過，這種方法有個小問題，那就是我們得先把主板上的啓動模式改成從 USB 啓動。如果我想防止別人用這種方法重置我電腦的登錄密碼，我把主板 BIOS 鎖定了不就行了？<strong>Boot Integrity Attack 就是這樣一種攻擊方法，直接對 BIOS 進行攻擊，從而篡改啓動信息，令攻擊設備得到系統的完全控制權。</strong>令人驚訝的是，這種攻擊方法早就被使用了，而且是大名鼎鼎的 NSA 用的。NSA 是哪裏？棱鏡門都知道吧？棱鏡門的發起者就是 NSA，美國國家安全局嘛。</p>
<p>NSA 的攻擊方式可是多種多樣。大家可能只知道 NSA 在 RSA 公司的產品裏面安裝後門這回事吧？遠不止這麼點攻擊方法。NSA 和很多公司都簽訂了協議，或者應用了很多技術，攻擊某些公司的特定設備，比如：</p>
<img class="content-image" src="https://pic2.zhimg.com/0c5070c2d9740e4c119b1296b272cf91_b.jpg" alt="">
<p>DeityBounce 就是利用這種技術，通過 USB 設備攻擊 BIOS，對 BIOS 進行篡改，從而得到系統的全部訪問權限。攻擊方法呢？很簡單，往服務器插個類似 U 盤的東西就行了&hellip; 我們還會看到，NSA 可不僅僅攻擊 Dell 的設備，還有很多其他的公司的設備也遭到了攻擊：</p>
<img class="content-image" src="https://pic2.zhimg.com/c80964ebd10fd3565a9fc5619549a9dd_b.jpg" alt="">
<p>當然了，這是 2008 年就被披露的了，現在這些設備是否安全我就不知道了。不過，大家想一想，公司或者學校上一次更換網絡硬件設備是什麼時候&hellip;&hellip;嗯，想想的話，有點後怕啊&hellip;&hellip;還有一些其他 NSA 採用的技術，比如攻擊硬盤固件的主引導區，從而獲取硬件控制權限：</p>
<img class="content-image" src="https://pic4.zhimg.com/b3609e32e84d8af1e20a24a466a4cf0f_b.jpg" alt="">
<p>實際上，不光是硬盤、BIOS，幾乎所有的固件設備都存在漏洞。比如鼠標和鍵盤中可能植入記錄操作的設備；USB 驅動程序可能有漏洞，被植入後門，等等等等。</p>
<img class="content-image" src="https://pic4.zhimg.com/b3609e32e84d8af1e20a24a466a4cf0f_b.jpg" alt="">
<p>2 Direct Memory Access Attack</p>
<p>回到上面的問題，密碼總是會被恢復的對嗎？那密碼恢復後總有個存儲的位置吧？這個位置就是我們的內存了。黑帽子們瞭解了這個，開心了。那我弄個設備，把內存中的所有數據都記錄下來，然後遠程發送給黑帽子，不就行了？</p>
<p><strong>Direct Memory Access Attack 就是這樣一種攻擊方式。在服務器中放置一個設備，這個設備可以隨時將內存中的信息讀取並記錄下來，然後遠程發送。</strong>NSA 也使用了這個技術進行攻擊。GINSU 就是 NSA 的攻擊方法工程。它是一個帶有無線功能的硬件設備。把這個設備插到服務器上，就可以對內存信息直接訪問，然後通過無線信道發送給黑帽子。</p>
<img class="content-image" src="https://pic4.zhimg.com/dfa32aafe587138a94fa342f036344db_b.jpg" alt="">
<p>不僅如此，我們還可以使用硬件接口執行 Direct Access Attack。早期 iPod 的硬件接口就有這樣的漏洞。在 iPod 接口中插入一個設備，擴展出一個 PCI 接口，就能夠通過這個 PCI 接口讀取內存數據了。</p>
<img class="content-image" src="https://pic3.zhimg.com/850b0d144a3eb094b08cc16415a653aa_b.jpg" alt="">
<p>3 Physical Memory Extraction</p>
<p>上述兩種攻擊方法雖然好，但是總得弄個什麼硬件設備吧？專業人士一來就能看出來。那麼，能不能不插硬件就能讀取內存數據呢？當然有！不過這要利用內存的一個特性：易失特性。</p>
<p>什麼叫易失特性呢？內存的數據讀寫速度很快，但是沒法長時間保存數據。掉了電了、重置了什麼的，都會導致內存數據的丟失。我想所有知友們都有過沒有 Ctrl+S 追悔莫及的經歷吧？這就是因爲計算機死機時，內存中的工作還沒有保存，寫入到硬盤中，從而導致了數據丟失。</p>
<p>不過，問題來了：內存真的具有易失特性嗎？答案是：不一定。要是搞點什麼，內存沒準就能保留一會數據了。</p>
<p>Princeton 大學的研究者們發現了這麼一個特性：電腦運行一段時間後關閉。關閉後立即把內存條拆下來，然後冷卻。奇蹟出現了&hellip; 內存中的數據還是在丟失，但是數據丟失速度大大降低了！實際上，這麼一來內存中的數據可以保留 1 分鐘左右的時間。</p>
<img class="content-image" src="https://pic2.zhimg.com/21ab8e6d72d7b7bbb5c0e267d2ef1539_b.jpg" alt="">
<p>這方法有用嗎？真的有用！演講者稱，他一個法律的同事，就是通過這種方法進行取證，成功率很高哦！</p>
<img class="content-image" src="https://pic1.zhimg.com/7701a5c764a166fce476271dfcbd801c_b.jpg" alt="">
<p>不過，拆內存總不是個好辦法&hellip;&hellip;那乾脆，黑帽子說了，我們找個機會，偷偷摸摸把服務器上的內存換了。花個大價錢，<strong>弄個不具有易失特性，但是讀寫速度依然很快的內存</strong>（這種內存當然更貴了&hellip;&hellip;）給它換上。這樣，內存中的數據不就可以長時間保留了嘛。的確有這種攻擊方法。黑帽子們更狠，這個內存不光具有非易失特性，還 TMD 有個硬盤&hellip;&hellip;隨時隨地把內存數據往硬盤裏面拷。過個幾年，找個機會把這個設備拆回去分析，就能得到數據了。</p>
<img class="content-image" src="https://pic4.zhimg.com/e18c3dc11875e944950f57a99db46f6f_b.jpg" alt="">
<p>4 防護方法？</p>
<p>這麼多神奇的攻擊方法，能防護嗎？當然了，魔高一尺道高一丈嘛！不過，我今天得睡了，防護措施，我們下週繼續。</p>
<img class="content-image" src="https://pic4.zhimg.com/828d6972d4acd6cf754b7fc9d1818863_b.jpg" alt="">



</div>
</div>
</div>


</div>
</div>