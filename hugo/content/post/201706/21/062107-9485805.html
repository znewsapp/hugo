+++
date = "2017-06-21T07:00:00"
title = "太難看不懂，太簡單容易被黑，每天都用的驗證碼花樣越來越多了"
titleimage = "https://pic1.zhimg.com/v2-e9452557077cf31a8c13a7b2f8f21b58.jpg"
ga = 062107
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">



<div class="question">
<h2 class="question-title">【騰訊 Bugly 乾貨分享】騰訊驗證碼的十二年</h2>
<div class="answer">



<div class="content">
<p>文章來自<a href="https://www.zhihu.com/org-intro">機構帳號</a>：<a class="PostIndex-authorName" href="https://www.zhihu.com/people/teng-xun-bugly" target="_blank">騰訊Bugly</a></p>
<hr>
<p>驗證碼的誕生就是用來對抗自動機，但隨着 OCR 技術的發展，騰訊驗證碼怎麼發展讓它能夠有效持續對抗自動機。</p>
<p><strong>一、騰訊驗證碼的誕生</strong></p>
<p>當然，鵝廠也經歷過沒有驗證碼的時代。這就得從十二年前那股瘋狂的&ldquo;掛太陽&rdquo;熱潮說起。如果是 QQ 老用戶，那你一定記得那些年我們掛過的星星、月亮和太陽。伴隨着這股熱潮，網絡上開始出現一種特殊服務&mdash;&mdash;代掛 QQ，也就是代掛團伙爲有需要的用戶長時間登錄 QQ 以提升等級，這就需要用戶把帳號密碼給到他們。</p>
<p>然而，這種黑產服務導致大量密碼遭到泄漏，壞人手裏掌握的密碼資源嘩啦啦多了起來，開始不斷嘗試盜號以獲利。因此，QQ 帳號開始頻繁遭到壞人自動化程序的暴力破解。</p>
<p>面對來勢洶洶的敵人，鵝廠急需新的對抗手法來攔住壞人瘋狂進攻的步伐！於是，正如大家所見，QQ 登錄場景中的驗證碼應運而生，並有效打斷了壞人自動機暴破的瘋狂節奏。從那時起，驗證碼正式登上我們的歷史舞臺。</p>
<p><strong>二、免驗證碼時代</strong></p>
<p>同學們應該還記得，在 2008 年之前，凡是在網頁上登錄 QQ 都得輸入驗證碼。沒錯，當時的策略是&ldquo;一視同仁&rdquo;，給全員下發驗證碼。經過一段時間的摸索，團隊開始意識到一個問題：驗證碼只是一種手段，不是目的。設立驗證碼這道防線的初衷，是爲了攔住&ldquo;壞人&rdquo;，而不是攔住&ldquo;所有人&rdquo;。</p>
<p>舉個例子，你在一處別墅開了個盛大的公衆派對。爲了防止不懷好意的人趁機混進來，你請了保安在門口進行安檢。可是，有沒有必要對所有來客都進行安檢呢？如果是認識多年的好友，或是常來你家串門的鄰居呢？如果你全都同等對待，友誼的小船肯定說翻就翻。</p>
<p>因此，安全平臺部聯合即通登錄團隊，開始嘗試對那些明顯是正常用戶的行爲免去下發驗證碼。也就是通過安全大數據的能力，自動區分機器與正常用戶，向機器下發驗證碼攔截，對好人則免驗證碼直接登錄，以此提升用戶體驗。在騰訊，我們把這項平衡安全和體驗的策略工作稱之爲&ldquo;免驗&rdquo;。</p>
<img class="content-image" src="https://pic4.zhimg.com/v2-fab91d5cb50b42c0220de084b8d2d2e3_b.jpg" alt="">
<p><strong>如圖，對可疑行爲下發驗證碼。</strong></p>
<p>在下發&ldquo;免驗&rdquo;策略初期，只能免掉 10%的驗證碼。隨着數據積累和能力的提高，時至今日免驗比例已達到 90%以上，大大免去了正常用戶辨別驗證碼的苦惱。直到現在，免驗策略還在持續優化。</p>
<p><strong>三、策略爲王</strong><strong>1、大魔術師</strong></p>
<p>當大部分的好人都不會遇到驗證碼時，另一頭，給壞人下發驗證碼的戰場還在繼續。進入 2010 年後，隨着微博和團購的橫空出世和快速發展，黑產從業者的可圖之利增多，互聯網黑產市場不斷擴張。作爲絕大多數互聯網業務的第一道安全防線，驗證碼的戰場正式進入了一段破解與抗破解的持久博弈。</p>
<img class="content-image" src="https://pic1.zhimg.com/v2-7c1d4c89d886a20c3f9c8009f6795d6c_b.jpg" alt="">
<p><strong>如圖，這是早期的密碼暴力破解軟件。</strong></p>
<p>在很長一段時間內，爲了避免被壞人的自動化程序識別，業界普遍把驗證碼設計得越來越複雜。長久下來，就形成了機器人和用戶都看不懂的尷尬局面。</p>
<p>顯然，把驗證碼&ldquo;複雜化&rdquo;這條道路走不通，那怎麼辦？在長期研究壞人的作惡模式及利益鏈條後，我們發現壞人在破解驗證碼時存在一大死穴&mdash;&mdash;時間。從一套新的驗證碼出現，到壞人成功破解，再集成到自動化軟件流入黑市，整個過程需要一個週期。那麼，如果我們更新驗證碼的速度快於壞人的工作週期，問題不就迎刃而解了？</p>
<p>做個假設，第一天，網站上了驗證碼 A，這套驗證碼簡單樸實、清晰可辨，簡直就是那麼多反人類驗證碼中的一股清流！壞人一瞅，這不是在藐視我的智商嗎？於是廢寢忘食連日研究，很快在第三天時就研究出了破解方案。正當壞人得意洋洋準備投入使用時，殊不知在第二天時網站已換上了驗證碼 B。這裏面的制勝點就一個字，快！</p>
<p>基於這種對抗理念，在 2011 年 7 月，&ldquo;魔術師&rdquo;驗證碼誕生了。如同魔術師快得讓人看不清的手法，魔術師驗證碼採用了高頻的切換策略，使對抗形成了&ldquo;敵方未破我先變&rdquo;的局面。果然，敵人自動機大軍的步伐被成功遏制，鎩羽而歸。</p>
<img class="content-image" src="https://pic4.zhimg.com/v2-1c396d358175c04d008e2996a4e714ff_b.jpg" alt="">
<p><strong>如圖，原有驗證碼 vs 魔術師驗證碼</strong></p>
<p><strong>2、猜你喜歡</strong></p>
<p>如同超級英雄電影裏一波又一波打不盡的反派一樣，爲了巨大的潛在利潤，敵人永遠不會消停。在&ldquo;魔術師&rdquo;換來了近一年的風平浪靜後，我們遭遇了有史以來最爲瘋狂的一波進攻。</p>
<p>由於魔術師的字體庫在現網已跑了一年，再加上圖像識別技術的發展，壞人幾乎已遍歷研究。以前，只要驗證碼的字體一切換，破解率立馬就會刷刷地往下掉。而現在，破解率僅小掉一下馬上又反彈了。換字體策略已失效！曾經立下無數汗馬功勞的魔術師驗證碼，如今成了一道馬其諾防線。</p>
<p>敵人已經兵臨城下，怎麼辦？經過研究我們發現，任何一種自動機，對驗證碼的識別率都不可能達到 100%，有驗證成功的圖片，肯定也有驗證失敗的圖片。做個假設，某種自動機的破解率是 10%，也就是指在 100 張圖片裏，有 90 張無法識別。那麼我們把這 90 張圖片收集起來，每次都給它下發這些圖片，10%的破解率會瞬間掉到 0%。因爲此時，自動機已陷入了繞不開的死結。</p>
<p>根據這個思路，2013 年元旦前，&ldquo;猜你喜歡&rdquo;驗證碼誕生了。&ldquo;猜你喜歡&rdquo;通過分析自動機行爲特徵，自動尋找、收集自動機的弱點，反覆攻敵之弱。這可以說是對自動化破解的&ldquo;致命一擊&rdquo;。</p>
<img class="content-image" src="https://pic1.zhimg.com/v2-83129f9242123725e247c30cbb9d243c_b.jpg" alt="">
<p><strong>如圖，原有驗證碼 vs 猜你喜歡驗證碼</strong></p>
<p>在體驗上，&ldquo;猜你喜歡&rdquo;擺脫了對圖片複雜性的依賴，做到了&ldquo;高清無碼&rdquo;，正常用戶的識別率提高到了 90%以上。在安全性上，防破解效果立竿見影，據團隊監測，氣急敗壞的敵人連最後的 IM 登錄驗證碼都不來嘗試破解了。&ldquo;猜你喜歡&rdquo;驗證碼以其強大的殺傷力，終於又換來了暫時的息戰。</p>
<p><strong>四、驗證碼的挑戰</strong></p>
<p>前面我們介紹的都是對抗自動機，然而隨着驗證碼對抗戰場越發激烈，黑產也推出驗證碼的殺手鐗&mdash;打碼平臺，利用廉價的人工智能， 從設計原理上突破驗證碼。驗證碼（CAPTCHA）的英文全稱就是全自動區分計算機和人類的圖靈測試，對方是人，驗證碼就失效了。</p>
<img class="content-image" src="https://pic3.zhimg.com/v2-c7b72501df07ee69086d8e6fee02e9b6_b.jpg" alt="">
<p><strong>如圖，打碼平臺的原理。</strong></p>
<p>而讓這個情況更糟糕的是打碼和深度學習結合，打碼平臺和使用打碼平臺的開發者給自動機破解程序提供樣本，通過神經網絡學習，破解程序可以很快做到非常高的破解率。</p>
<p>正如外國學者 Elie Bursztein 等人所編著的論文（The End is Nigh: Generic Solving of Text-based CAPTCHAs），字符驗證碼終結將至。</p>
<p><strong>五、新驗證碼時代</strong></p>
<p>字符輸入是我們最熟悉最常遇到的驗證碼，然而在打碼平臺和深度學習的結合下，字符驗證碼最終將會退出舞臺。</p>
<img class="content-image" src="https://pic2.zhimg.com/v2-1cb31376b31b5c4e1fe16b7ec48d560d_b.jpg" alt="">
<p><strong>如圖，12306 識圖驗證碼 vs 知乎倒立驗證碼</strong></p>
<img class="content-image" src="https://pic2.zhimg.com/v2-5bbc1a93de58ce2b43781bb135c1a681_b.jpg" alt="">
<p><strong>如上圖，Google 的 nocaptcha vs 極驗、阿里滑動驗證碼</strong></p>
<p>鵝廠從 2013 年開始嘗試新型驗證碼，2013 年的識圖驗證碼。和 12306 驗證碼很像，當時的圖片是設計師畫的，最終因爲圖片資源難以滿足自動機對抗要求的海量數量需求而暫時沒推廣。還有 2014 年第一版拼圖驗證碼嘗試。</p>
<img class="content-image" src="https://pic4.zhimg.com/v2-3e77734c4f04e21a608c31e7211255b3_b.jpg" alt="">
<p>新時代驗證碼需要更大的舞臺和更快的反應：摒棄了過去多年對字符的依賴，它可以快速支持和推廣新型交互驗證碼。另外，用戶在完成操作同時，前端會收集用戶行爲數據，通過機器學習，爲線上策略輸出更準確有效的策略。</p>
<img class="content-image" src="https://pic3.zhimg.com/v2-4a1d1078e888b313f7bfae319420699e_b.jpg" alt="">
<p><strong>如圖，幾種新型驗證碼。</strong></p>
<p><strong>六、最後的話</strong></p>
<p>在上世紀五十年代，人工智能之父阿蘭&bull;圖靈設計出了圖靈測試。在約半個世紀後，圖靈測試的理念被做成最簡單粗暴的形式&mdash;&mdash;驗證碼，滲透到人們互聯網生活的方方面面。然而，驗證碼是一個時代的產物，是一種治標不治本的速效手段。戰術和戰略的改變，纔是終極解決方法。</p>
<p>可以預想，終有一天驗證碼會退出互聯網的歷史舞臺。但現階段，由於鉅額潛在利潤的驅動，不法之徒必定不會放棄對驗證碼的虎視眈眈。無論是過去、現在，亦或是不遠的將來，這都註定是一場沒有硝煙的血戰。未來，我們拭目以待。</p>
<p>好的，今天的分享就到這裏。非常謝謝大家。也歡迎同學們一起來探討。</p>
<hr>
<p><strong>互動問答</strong></p>
<p><strong>Q1：字符驗證碼爲什麼不好，不適應時代了？聽了你們這麼說，我也在想字符驗證碼是不是要換</strong></p>
<blockquote>隨着 OCR 的發展，字符驗證碼對抗非常艱難。字符驗證碼的舞臺太小，繼續發展下去，會出現自動機容易破解而人很難通過的狀況。不過騰訊有很多業務還在用字符驗證碼，字符驗證碼完全退出舞臺還需要一段時間，我們也在向業務推廣新型驗證碼。</blockquote>
<p><strong>Q2：不明白那個滑動驗證碼有什麼不一樣的地方，感覺自動化破解應該很容易，不像其他的，需要語意識別</strong></p>
<blockquote>從字符驗證碼到多樣化驗證碼的轉變，最主要的變化，其實是驗證碼不再單純的依賴圖像去對抗，而是加入了更多元化更全面的元素，比如用戶行爲識別、後臺策略對抗等，只依賴圖像原因不夠，但圖像加上大數據和 AI 的強力支撐是可以對抗壞人的。也是因爲這樣，用戶反而能用上體驗更好的驗證碼</blockquote>
<p><strong>Q3：拼圖驗證碼的拼圖塊是怎麼生成的？又是怎麼校驗的呢？</strong></p>
<blockquote>從圖庫拉取一張圖片，隨機在圖片摳取一張小拼圖塊。服務器生成時會記錄小接圖塊的位置。用戶在將小拼圖塊拖動到目標位置時，提交座標給服務器進行答案校驗。</blockquote>
<p><strong>Q4：就上面提到的各種驗證碼來講，現在哪種驗證碼的效果最好呢？</strong></p>
<blockquote>不同產品面臨的戰場不一樣，比較難下定論說哪一種驗證碼效果最好。各大公司的安全團隊在驗證碼方面也下了很多功夫，但從目前壞人的手段和技術來看，大家拼的更多的是後臺策略，而不是單純的驗證碼本身了。適合自己的纔是最好的。</blockquote>
<p><strong>Q5：模擬用戶操作爲什麼打碼平臺無法破解呢？本質上應該也是識別圖片信息並上傳相應的數據吧？</strong></p>
<blockquote>首先，新驗證碼也有打碼，比如像下圖這種打碼軟件，所以只靠圖像沒辦法對抗碼工。這種軟件提交的答案也有其特徵，座標答案由碼工標註，惡意程序合成行爲數據，新驗證碼對這種情況是可以區分的。<br><img class="content-image" src="https://pic2.zhimg.com/v2-a87aee9c9c550a31a4d9a4476bb51901_b.jpg" alt=""></blockquote>
<p><strong>Q6：現在日益的發展下.指紋驗證的頻率也越來越高.有沒有對這方面的考慮?</strong></p>
<blockquote>指紋驗證本質是身份驗證，驗證碼是對抗自動機，不過隨着移動設備指紋的普及，用指紋做身份驗證，免去驗證碼是有可能的。</blockquote>
<p><strong>Q7：現在經常 Q 羣裏喊着坐家就能賺錢的那種軟件，好像就是把驗證碼下發出去，讓社會閒散人員幫你識別，這種怎麼破？</strong></p>
<blockquote>對於人工打碼，5 的問題有提到一些解決思路。但還是基於現在打碼平臺，如果打碼平臺升級，確實這裏的識別非常困難，大家有什麼好的思路也可以發郵箱給我：80000768@qq.com</blockquote>
<p><strong>Q8：是不是可以根據用戶職業和身份來給用戶出些相關專業的常識作爲驗證碼？或者是有哪些用戶認識的 QQ 好友讓他選擇也行啊？</strong></p>
<blockquote>這個方法是可行的，實際上 facebook 也有采用這個方式來對用戶進行驗證。這個手段來對抗碼工是一種比較好的方式，但他的侷限性也很明顯，使用門檻比較高，一來是有可能泄漏用戶隱私信息，二來他使用場景很有限，在註冊、活動、拉新等沒有用戶信息的場景無法派上用場</blockquote>
<p><strong>Q9：用戶要記住使用密碼和要識別驗證碼，感覺都屬於反人類設計，驗證碼未來什麼情況下可能退出歷史？</strong></p>
<blockquote>驗證碼的用戶體驗需要不斷地優化完善，但其實驗證碼的設立很大程度上是爲了對抗高頻的暴力破解，阻擋壞人的自動機進攻的步伐。所以在現階段還是非常必要的。驗證碼徹底退出歷史舞臺，預計還需要比較長的一段時間。</blockquote>
<p><strong>Q10：將來有沒有可能用到語音驗證？</strong></p>
<blockquote>關於語音驗證碼，大家用微信也知道，語音識別技術很成熟，識別率已經很高了，因此用來做驗證碼效果也不見得會好</blockquote>
<p><strong>Q11：手機端 app 驗證碼大多都比較簡單，爲什麼 pc 端的特別複雜？</strong></p>
<blockquote>這個其實有歷史原因在裏頭。在前些年，4G 沒普及，上網速度慢，驗證碼的圖片不可能做得太大，會影響頁面打開速度；而且那個時候也沒很多大屏手機，屏幕小，留給驗證碼發揮的地方也小。從那個時候就延續下來了。但現在其實很多手機驗證碼都和 PC 一致了</blockquote>
<p><strong>Q12：大量用戶去請求驗證碼，怎麼確定每個人驗證碼對應的就是相應的用戶？</strong></p>
<blockquote>驗證碼的架構設計之初，已經是按照億萬級訪問的場景來設計的，能支撐起大量用戶訪問的</blockquote>
<p><strong>Q13：前端會收集用戶行爲數據，通過機器學習，爲線上策略輸出更準確有效的策略。 同樣的道理,可以通過機器學習模擬用戶的行爲軌跡從而來破解滑動拼圖驗證碼. 這個怎麼破?</strong></p>
<blockquote>這個問題問得十分漂亮。目前驗證碼主要的戰場和矛盾點也是這個，隨着機器學習的不斷髮展，我們遇到的挑戰也越來越多，但即使這樣，我們還是會不斷朝這個方向努力，不斷嘗試和跟壞人鬥智鬥勇。</blockquote>
<p><strong>Q14：怎麼評價阿里雲的這種驗證碼，基於當前登錄賬號的歷史數據提問，微信好像也有采用這種形式，比如選擇好友。</strong></p>
<img class="content-image" src="https://pic4.zhimg.com/v2-7a4b82c150a19bb20bbee7ef58f57093_b.jpg" alt="">
<blockquote>基於當前登錄帳號的歷史數據提問，跟上面的一個問題類似的，這種更多是身份驗證，用在登錄場景比較合適，但其他場景，比如註冊，就無法發揮用途。另外，用戶個人信息是有限的，經過多次嘗試不斷比對和過濾，也能獲得正確答案。在無登錄態下暴露用戶信息也是很一個很大的隱患，因此鵝廠在這類驗證碼上的應用比較慎重，並沒有大規模的用。</blockquote>
<hr>
<p>本文來自於<a class=" wrap external" href="https://link.zhihu.com/?target=https%3A//bugly.qq.com/" target="_blank" rel="nofollow noreferrer">騰訊 bugly 開發者社區</a>，未經作者同意，請勿轉載，原文地址：<a class=" wrap external" href="https://link.zhihu.com/?target=http%3A//dev.qq.com/topic/581301b146dfb1456904df8d" target="_blank" rel="nofollow noreferrer">【Dev Club 分享第十三期】騰訊驗證碼的十二年</a></p>
<p>作者：騰訊 TEG 安全平臺部 張彥玲、陳秋瀅、華珊珊</p>
<hr>
<p>「知乎<span class="lG">機構</span><span class="lG">帳號</span>」是<span class="lG">機構</span>用戶專用的知乎<span class="lG">帳號</span>，與知乎社區內原有的個人<span class="lG">帳號</span>獨立並行，其使用者爲有正規資質的組織<span class="lG">機構</span>，包括但不限於科研院所、公益組織、政府機關、媒體、企業等。這不僅是知乎對<span class="lG">機構</span>的「身份認證」，更是涵蓋了內容流通機制、<span class="lG">帳號</span>規範等全套<span class="lG">帳號</span>體系。和個人<span class="lG">帳號</span>一樣，<span class="lG">機構</span><span class="lG">帳號</span>開通不需要任何費用，同時也受社區規範的監督管理，並要遵守相關協議。目前<span class="lG">機構</span><span class="lG">帳號</span>入駐採用邀請制。您可以通過 &nbsp;<a href="http://zhihu.com/org-intro" target="_blank">什麼是「知乎機構帳號」</a>&nbsp;來了解更多<span class="lG">機構</span><span class="lG">帳號</span>信息。</p>



</div>
</div>
</div>


</div>
</div>