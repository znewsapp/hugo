+++
date = "2017-03-14T20:00:00"
title = "一串「0」和「1」是如何在網線裏奔跑的？"
titleimage = "http://pic1.zhimg.com/8388e39fdc7ab9992df06616f2036b90.jpg"
ga = 031420
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">




<div class="question">
<h2 class="question-title">數據怎樣在網絡中傳輸的？要經過怎樣的包裝才能保證傳輸準確？</h2>

<div class="answer">



<div class="content">
<p>這個問題讓我彷彿看到自己年輕時候的影子，所以我想鄭重地回答這個問題。</p>
<img class="content-image" src="http://pic1.zhimg.com/70/v2-a09e4cc286a832fc2d4fbb3623a09834_b.jpg" alt="">
<p>時間追溯到 2001 年，做硬件的組長和我一起調試數字地圖系統，控制系統與數字地圖系統用一根電纜相連接，控制系統負責發送指令，地圖系統負責接收指令，並根據指令的具體內容&ldquo;放大、縮小、Zoom、加載航線、去除航線&rdquo;等等，做具體的動作。</p>
<p>比如放大的<strong>指令代碼&ldquo;0x85&rdquo;</strong>，發出去之後，數字地圖就會放大地圖，有時放大指令發送了，可地圖系統卻沒有動靜，這時就需要排查了，最有效的排查工具就是組長的&ldquo;示波器&rdquo;，示波器的探針連在電路板接收、發送引腳，就會清晰地看到波形，組長把波形用二進制寫下來：&ldquo;<strong>10000101</strong>&rdquo;，然後對我說，看來你的指令發送出來了，指令是十六進制的&ldquo;0x85&rdquo;，看來是地圖系統沒有處理，接下來進一步排查不表。</p>
<p>看組長嫺熟的排查手法，內心充滿着很多好奇，整天跟在組長屁股後頭，看他怎麼解決問題的。那時恰好在學 OSI 參考模型，我就問組長，</p>
<p><strong>第一個問題：組長</strong><strong>，爲何我的指令數據&ldquo;0x85&rdquo;在線路上裸奔，沒有一點數據鏈路層的協議頭？</strong></p>
<p>組長說：因爲是點對點連接，這邊發，對方接，無需華而不實的頭部，對方接收到指令之後，只要明白指令的具體含義就 OK！這樣實現起來簡單明瞭。</p>
<p><strong>第二個問題：組長，那如果我發送指令數據很快，會不會造成指令信號的重疊，相互干擾？</strong></p>
<p>組長：我們使用的&nbsp;<strong>RS-232&nbsp;</strong>串行接口，默認有一個發送速率，<strong>9.6Kbps</strong>，兩端需要速率匹配才能正常工作，假如這裏兩端都是 9.6Kbps，如果發送端的程序，比如這裏的控制系統想發 15Kbps 的數據，可以把這個 RS-232 接口模塊看成一個小蓄水池，一根進水管，流入速率 15Kbps，一根出水管，流出最大速率 9.6Kbps，很顯然有&nbsp;<strong>5.4Kbps 的水不能及時排出</strong>，留在蓄水池裏（硬件緩衝內存），但這個蓄水池很小，總有盛滿的時候，如果進水管不停、或者降速，則<strong>多餘的水會溢出蓄水池！（數據丟棄）</strong></p>
<p>所以控制系統最終能發多快的數據，最終是由硬件的發送速率限制的，硬件在發送數據時，信號與信號之間，是有間隔的，否則接收方無法分辨是一個信號、還是多個信號，既然有間隔，信號在線纜上的傳輸速率完全相同，所以不會造成信號重疊、干擾！</p>
<p>還要補充一點，發送方硬件即使知道有很多數據在排隊發送，但是一秒鐘能發多少位的數據是有上限的。</p>
<p>突然想到了高速公路的車流，高速公路入口涌入過多的汽車，高速公路的流速就會顯著下降。可信號卻不是這樣的，只要信號發送到線路上，它的流速是恆定的，接近光速。通俗的話來說，要麼不發，要發就是光速，網絡的擁堵不是發生在出水管，而是發生在蓄水池！而高速公路因爲沒有蓄水池，只有依靠降低流速來容納更多的車輛。</p>
<p><strong>第三個問題：組長，訪問美國的網站，數據在線路上，是不是也是 0、1 組成的大段的波形？這些波形之間是否也有間隙？我聽到一個新名詞：路由器，那路由器如何處理這些波形？使得這些 0、1 波形最終到達終點？</strong></p>
<p>組長：是的，其實互聯網上的原理和我們這個系統很相似，用戶的數據是以一串的 0、1 二進制波形發送到線路上，這些波形之間是有間隙的，比如我們實驗室的以太網上的波形（以太幀），幀與幀之間是有分隔的，這樣接收方就可以將兩個分隔的幀獨立處理。</p>
<p>說到路由器，你最近不是在看網絡的書的嗎？路由器是用來幫用戶 IP 包尋找目的地在哪裏的！</p>
<p>比如上文路由器接到一個以太幀，經過路由器網卡處理，路由器就會看到一串 0、1 組成的字符串，如果這個字符串只是指令代碼&ldquo;0x85&rdquo;，沒有其他的了，那路由器如何知道這指令代碼&ldquo;0x85&rdquo;是去往何處的呢？</p>
<p>這裏如果在&ldquo;0x85&rdquo;前有地址信息，類似信封上的收件人地址一樣的信息，路由器就不會懵逼了，路由器根據收件人地址，查詢地址就可以發給更靠近目的地的下一跳路由器了，下一跳也是採用類似的辦法，直到最終找到收件人，然後就可以將指令代碼&ldquo;0x85&rdquo;轉交給收件人！</p>
<p>用來容納收件人地址的就是&nbsp;<strong>IP&nbsp;</strong>頭，收件人地址對應的就是目的 IP 地址，那就是如下方式：IP + &ldquo;0x85&rdquo;</p>
<p>看出來了沒有，有了這個 IP 頭，假設目的 IP= &ldquo;8.8.8.8&rdquo;，我們就可以將這個指令代碼，跨國太平洋光纜發往美國。如果願意，可以將目的 IP&nbsp;修改成任何公網 IP 地址，可以將指令代碼&ldquo;0x85&rdquo;發到互聯網世界上的任何一個角落。</p>
<p>而沒有這個神奇的 IP 頭，我們只能將指令代碼&ldquo;0x85&rdquo;在兩臺物理直連的設備之間傳輸，物理侷限性太大。</p>
<p>補充一點，不要忘記，<strong>IP&nbsp;</strong>是&nbsp;<strong>Internet Protocol&nbsp;</strong>的縮寫，IP 使得互聯網成爲可能。</p>
<p>車小胖望着組長儒雅而淡然的面孔，內心有一個想法，如果有一天有人問我同樣的問題，我會把組長的答案原封不動地分享給他！</p>
</div>
</div>




</div>


</div>
</div>